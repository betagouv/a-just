<aj-wrapper #wrapper id="simu-wrapper" title="Simulateur" [actionTemplate]="actions" [alignLeft]="true"
  [documentation]="documentation">
  <div class="progress-bar" *ngIf="isLoading">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </div>
  <div class="action-simulator-bar" [ngClass]="{'hide': whiteSimulator === true}">
    <img src="assets/images/logo-ajust.png" class="logo-ajust" width="60px" height="46px" />

    <aj-select title="Contentieux (obligatoire)" class="contentieux width-auto {{disabled}}"
      [defaultRealValue]="'Sélectionner un contentieux'" [value]="contentieuId" [datas]="formReferentiel"
      (valueChange)="updateReferentielSelected('referentiel', $event)" [multiple]="false">
    </aj-select>
    <aj-select title="Sous-contentieux (option)" class="contentieux width-auto {{disabled}}"
      [class.notSelectable]="contentieuId===null" [value]="subList" [datas]="formReferentiel" [subList]="subList"
      [parent]="contentieuId" (valueChange)="updateReferentielSelected('subList', $event)">
    </aj-select>
    <div class="categories-switch">
      <div *ngIf="canViewMagistrat" class="magistrats {{disabled}}"
        [ngClass]="{'selected': categorySelected === 'MAGISTRAT',  alone: !canViewGreffier}"
        (click)="$event.stopPropagation(); changeCategorySelected('MAGISTRAT'); ">
        <input type="radio" [checked]="categorySelected === 'MAGISTRAT'" />
        <p>Magistrats</p>
      </div>
      <div *ngIf="canViewGreffier" class="fonctionnaires {{disabled}}"
        [ngClass]="{'selected': categorySelected === 'FONCTIONNAIRE', alone: !canViewMagistrat}" class="fonctionnaires"
        (click)="$event.stopPropagation(); changeCategorySelected('FONCTIONNAIRE')">
        <input type="radio" [checked]="categorySelected === 'FONCTIONNAIRE'" />
        <p>Fonctionnaires</p>
      </div>
    </div>
    <aj-select class="contentieux fonctions-selection width-auto {{disabled}}" title="Choix des fonctions (option)"
      [value]="selectedFonctionsIds" [datas]="functionsList" [defaultAllValue]="'Toutes'"
      (valueChange)="onChangeFonctionsSelected($event)">
    </aj-select>
  </div>
  <div class="top-bar-container" [ngClass]="{'hide': whiteSimulator === true}">
    <p>Période choisie :</p>

    <div class="container-timeline">
      <div class="container-timeline-button">
        <aj-date-select-blue class="select-disabled {{mooveClass}} {{disabled}}" [value]="dateStart"
          (valueChange)="updateReferentielSelected('dateStart', $event)" [max]="dateStop" [min]="today">
        </aj-date-select-blue>
        <div class="space"></div>
        <aj-date-select-blue class="{{disabled}}" [title]="'Fin de période'" [value]="dateStop"
          (valueChange)="updateReferentielSelected('dateStop', $event)" [min]="getMin()" [side]="'right'">
        </aj-date-select-blue>
      </div>
      <div class="Rectangle">
        <div class="dot {{mooveClass}}"></div>
        <div class="blue-line {{mooveClass}}">
          <div *ngFor="let d of nbOfMonthWithinPeriod" class="dot-generated-container">
            <div class="dot-generated"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="items before-after" [ngClass]="{'hide': whiteSimulator === true}">
    <div class="item blue-bg">
      <p>Entrées moyennes mensuelles</p>
    </div>
    <div class="item">
      <p>Sorties mensuelles possibles</p>
    </div>
    <div class="item blue-bg">
      <p>Stock</p>
    </div>
    <div *ngIf="canViewMagistrat" class="item" [ngClass]="{'selected': categorySelected === 'MAGISTRAT'}">
      <p>ETPT magistrat</p>
    </div>
    <div *ngIf="canViewGreffier" class="item blue-bg" [ngClass]="{'selected': categorySelected === 'FONCTIONNAIRE'}">
      <p>ETPT greffe</p>
    </div>
    <div *ngIf="canViewContractuel" class="item">
      <p>ETPT contractuels</p>
    </div>
    <div class="item blue-bg">
      <p>Taux de couverture</p>
    </div>
    <div class="item"
      [ngClass]="{'selected': categorySelected === 'MAGISTRAT' || categorySelected === 'FONCTIONNAIRE'}">
      <p>DTES</p>
    </div>
    <div class="item blue-bg"
      [ngClass]="{'selected': categorySelected === 'MAGISTRAT' || categorySelected === 'FONCTIONNAIRE'}">
      <p>Temps moyen / dossier</p>
    </div>
  </div>
  <div class="actual-situation"
    *ngIf="((subList.length!==0 && selectedFonctionsIds.length!==0 ) || this.getElementById(this.contentieuId)?.childrens?.length===0) &&  firstSituationData !== null"
    [@fadeInOut] [ngClass]="{'hide': whiteSimulator === true}">
    <div class="line-title">
      <p>
        Situation{{startRealValue? ' au':''}}<br />
        {{startRealValue || "à aujourd'hui"}}
      </p>
    </div>

    <div class="line-item orange-bg" #tooltip="matTooltip"
      [matTooltip]="'Valeur exacte d\'entrées utilisée dans les calculs : '+ trunc('totalIn',firstSituationData,false,true)"
      matTooltipPosition="left" matTooltipShowDelay="0" matTooltipHideDelay="0">
      <input [value]="getFieldValue('totalIn',firstSituationData)" disabled />
    </div>
    <div class="line-item">
      <input [value]="getFieldValue('totalOut',firstSituationData)" disabled />
    </div>
    <div class="line-item orange-bg">
      <input [value]="getFieldValue('lastStock',firstSituationData)" disabled />
    </div>
    <div *ngIf="canViewMagistrat" class="line-item" [ngClass]="{'selected': categorySelected === 'MAGISTRAT'}">
      <input [value]="getFieldValue('etpMag',firstSituationData)" disabled />
    </div>
    <div *ngIf="canViewGreffier" class="line-item orange-bg"
      [ngClass]="{'selected': categorySelected === 'FONCTIONNAIRE'}">
      <input [value]="getFieldValue('etpFon',firstSituationData)" disabled />
    </div>
    <div *ngIf="canViewContractuel" class="line-item">
      <input [value]="getFieldValue('etpCont',firstSituationData)" disabled />
    </div>
    <div class="line-item orange-bg">
      <input [value]="getFieldValue('realCoverage',firstSituationData)" disabled />
    </div>
    <div class="line-item"
      [ngClass]="{'selected': categorySelected === 'MAGISTRAT' || categorySelected === 'FONCTIONNAIRE'}">
      <input [value]="getFieldValue('realDTESInMonths',firstSituationData)" disabled />
    </div>
    <div class="line-item orange-bg"
      [ngClass]="{'selected': categorySelected === 'MAGISTRAT' || categorySelected === 'FONCTIONNAIRE'}">
      <input [value]="getFieldValue('magRealTimePerCase',firstSituationData)" disabled />
    </div>
  </div>

  <div class="actual-situation color-blue" *ngIf="dateStop!==null && projectedSituationData !== null" [@fadeInOut]
    [ngClass]="{'hide': whiteSimulator === true}">
    <div class="line-title">
      <p>
        Situation projetée<br />
        au {{stopRealValue}}
      </p>
    </div>

    <div class="line-item grey-bg" #tooltip="matTooltip"
      [matTooltip]="'Valeur exacte d\'entrées utilisée dans les calculs : '+ trunc('totalIn',projectedSituationData,false,true)"
      matTooltipPosition="left" matTooltipShowDelay="0" matTooltipHideDelay="0">
      <input [value]="getFieldValue('totalIn',projectedSituationData)" disabled />
    </div>
    <div class="line-item">
      <input [value]="getFieldValue('totalOut',projectedSituationData)" disabled />
    </div>
    <div class="line-item grey-bg">
      <input [value]="getFieldValue('lastStock',projectedSituationData)" disabled />
    </div>
    <div *ngIf="canViewMagistrat" class="line-item" [ngClass]="{'selected': categorySelected === 'MAGISTRAT'}">
      <input [value]="getFieldValue('etpMag',projectedSituationData)" disabled />
    </div>
    <div *ngIf="canViewGreffier" class="line-item grey-bg"
      [ngClass]="{'selected': categorySelected === 'FONCTIONNAIRE'}">
      <input [value]="getFieldValue('etpFon',projectedSituationData)" disabled />
    </div>
    <div *ngIf="canViewContractuel" class="line-item">
      <input [value]="getFieldValue('etpCont',projectedSituationData)" disabled />
    </div>
    <div class="line-item grey-bg">
      <input [value]="getFieldValue('realCoverage',projectedSituationData)" disabled />
    </div>
    <div class="line-item"
      [ngClass]="{'selected': categorySelected === 'MAGISTRAT' || categorySelected === 'FONCTIONNAIRE'}">
      <input [value]="getFieldValue('realDTESInMonths',projectedSituationData)" disabled />
    </div>
    <div class="line-item grey-bg"
      [ngClass]="{'selected': categorySelected === 'MAGISTRAT' || categorySelected === 'FONCTIONNAIRE'}">
      <input [value]="getFieldValue('magRealTimePerCase',projectedSituationData)" disabled />
    </div>
  </div>
  <div class="actual-situation color-white" *ngIf="dateStop!==null  && projectedSituationData !== null" [@fadeInOut]
    [ngClass]="{'hide': whiteSimulator === true}">
    <div class="options">
      <div id="init-button" class="init-button"
        (click)="initParams([totalIn, totalOut, lastStock, categorySelected === 'MAGISTRAT' ?etpMag:etpFon, realCoverage, realDTESInMonths, magRealTimePerCase])">
        <p class="title">Réinitialiser</p>
      </div>
      <div class="simulate-button {{simulateButton}}"
        (click)="simulate([totalIn, totalOut, lastStock, categorySelected === 'MAGISTRAT' ?etpMag:etpFon, realCoverage, realDTESInMonths, magRealTimePerCase])">
        <p class="title">Simuler</p>
      </div>
    </div>
    <div class="line-title">
      <p>
        Modifier<br />
        des paramètres
      </p>
    </div>
    <aj-popup style="z-index:200;" *ngIf="toSimulate===true" [closeIcon]="true" (onClose)="toSimulate = false"
      [removeShadow]="'noShadow'">
      <div id="circle">
        <img src="/assets/icons/calculatrice.svg" />
      </div>
      <p>Je souhaite lancer la simulation...</p>
      <div class="choices">
        <div class="choice"
          (click)="selectParamToLock(0,[totalIn, totalOut, lastStock, etpMag,etpFon, realCoverage, realDTESInMonths, magRealTimePerCase])">
          à {{getLockedParamLabel(0)}}
          <br />constant{{getLockedParamLabel(0)!=='entrées
          mensuelles'&&getLockedParamLabel(0)!=='sorties mensuelles'?'':'es'}}
        </div>
        <div class="choice"
          (click)="selectParamToLock(1,[totalIn, totalOut, lastStock, etpMag,etpFon, realCoverage, realDTESInMonths, magRealTimePerCase])">
          à {{getLockedParamLabel(1)}}
          <br />constant{{getLockedParamLabel(1)!=='entrées
          mensuelles'&&getLockedParamLabel(1)!=='sorties mensuelles'?'':'es'}}
        </div>
      </div>
    </aj-popup>

    <aj-popup *ngIf="openPopup===true" [actions]="[
    { id: 'modify', content: 'Ajuster', fill: true }
  ]" [closeIcon]="true" (onClose)="openPopup = false" [removeShadow]="'noShadow'"
      (keypress)="onKeypressEvent($event,volume.value,buttonSelected,[totalIn, totalOut, lastStock, etpMag, realCoverage,realDTESInMonths,magRealTimePerCase])"
      (selectedAction)="setParamsToAjust(volume.value,buttonSelected,[totalIn, totalOut, lastStock, etpMag, realCoverage,realDTESInMonths,magRealTimePerCase])">
      <div id="circle">
        <img src="/assets/icons/stock.svg" />
      </div>
      <p>Ajustement {{getText('title')}}</p>

      <div class="rectangle">
        <div class="title"
          *ngIf="buttonSelected.id !== 'etpMag' && buttonSelected.id !== 'etpFon' &&buttonSelected.id !== 'totalOut' && buttonSelected.id !== 'totalIn'&& buttonSelected.id !== 'magRealTimePerCase'">
          Atteindre au {{stopRealValue}} <br />
          {{getText('firstInput')}} :
        </div>
        <div class="title"
          *ngIf="buttonSelected.id === 'etpMag' || buttonSelected.id === 'etpFon' ||buttonSelected.id === 'totalOut'|| buttonSelected.id === 'totalIn'|| buttonSelected.id === 'magRealTimePerCase'">
          Appliquer sur la période {{startRealValue? "du":"d'"}}
          {{startRealValue||"aujourd'hui"}} au {{stopRealValue}} {{
          buttonSelected.id==='etpFon' ? "un volume moyen d'ETPT greffe":
          buttonSelected.id==='etpMag' ? "un volume moyen d'ETPT magistrat":
          buttonSelected.id === 'totalOut'?"un volume moyen de sorties
          mensuelles": buttonSelected.id === 'totalIn'? "un volume moyen
          d'entrées mensuelles":"un temps moyen par dossier"}} de :
        </div>
        <input [class.displayNone]="buttonSelected.id === 'magRealTimePerCase'" type="number"
          (oninput)="onUpdateValueToAjust($event)" (focusin)="resetPercentage = true"
          (focusout)="resetPercentage = false" value="{{valueSaved(1)}}" #volume />
        <app-time-selector *ngIf="buttonSelected.id === 'magRealTimePerCase'" [value]="parseFloat(valueSaved(1))"
          [category]="'MAGISTRATS'" (valueChange)="valueChange(volume,$event)"></app-time-selector>
      </div>
      <div class="rectangle" *ngIf="getNbOfParams()===2">
        <div class="title">
          Définir {{getText('secondInput')}} :<br />
          <span>(en % par rapport à la situation {{startRealValue? 'au' : "d'"}}
            {{startRealValue||"aujourd'hui"}})</span>
        </div>
        <aj-input-percentage (focusin)="volume.value = ''"
          [referenceValue]="getReferenceValue(getFieldValue(buttonSelected.id,firstSituationData))"
          [reset]="resetPercentage" [defaultValue]="valueSaved(2)" (valueChange)="onUpdateValueToAjust($event)">
        </aj-input-percentage>
      </div>
    </aj-popup>
    <div class="line-item blue-bg">
      <input class="ajusted-button" id="totalIn" [class.filled]="totalIn.value!=='Ajuster'"
        (click)="openPopupWithParams(totalIn)" value="Ajuster" readonly="readonly" #totalIn />
      <div class="modified-label" #tooltip="matTooltip" [matTooltip]="getTooltipText()" matTooltipShowDelay="0"
        matTooltipHideDelay="0"
        *ngIf="paramsToAjust.param1.label===totalIn.id  || paramsToAjust.param2.label===totalIn.id" [@fadeInOut]>
        {{percentageModifiedInputText(totalIn.id,getFieldValue('totalIn',firstSituationData))}}%

        <div class="triangle"></div>
      </div>
    </div>
    <div class="line-item">
      <input class="ajusted-button" id="totalOut" [class.filled]="totalOut.value!=='Ajuster'"
        (click)="openPopupWithParams(totalOut)" value="Ajuster" readonly="readonly" #totalOut />
      <div class="modified-label" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
        [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
        matTooltipHideDelay="0"
        *ngIf="paramsToAjust.param1.label===totalOut.id  || paramsToAjust.param2.label===totalOut.id" [@fadeInOut]>
        {{percentageModifiedInputText(totalOut.id,getFieldValue('totalOut',firstSituationData))}}%
        <div class="triangle"></div>
      </div>
    </div>
    <div class="line-item blue-bg">
      <input class="ajusted-button" id="lastStock" [class.filled]="lastStock.value!=='Ajuster'"
        (click)="openPopupWithParams(lastStock)" value="Ajuster" readonly="readonly" #lastStock />
      <div class="modified-label" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
        [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
        matTooltipHideDelay="0"
        *ngIf="paramsToAjust.param1.label===lastStock.id  || paramsToAjust.param2.label===lastStock.id" [@fadeInOut]>
        {{percentageModifiedInputText(lastStock.id,getFieldValue('lastStock',firstSituationData))}}%

        <div class="triangle"></div>
      </div>
    </div>
    <div [ngClass]="{'hide-by-category': !canViewMagistrat}" class="line-item">
      <input class="ajusted-button" id="etpMag" [class.filled]="etpMag.value!=='Ajuster'"
        (click)="openPopupWithParams(etpMag)" value="Ajuster" readonly="readonly"
        [ngClass]="{disable: categorySelected !== 'MAGISTRAT'}" #etpMag />
      <div class="modified-label" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
        [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
        matTooltipHideDelay="0"
        *ngIf="paramsToAjust.param1.label===etpMag.id  || paramsToAjust.param2.label===etpMag.id" [@fadeInOut]>
        {{percentageModifiedInputText(etpMag.id,getFieldValue('etpMag',firstSituationData))}}%

        <div class="triangle"></div>
      </div>
    </div>
    <div [ngClass]="{'hide-by-category': !canViewGreffier}" class="line-item blue-bg">
      <input class="ajusted-button" id="etpFon" [class.filled]="etpFon.value!=='Ajuster'"
        (click)="openPopupWithParams(etpFon)" value="Ajuster" readonly="readonly"
        [ngClass]="{disable: categorySelected !== 'FONCTIONNAIRE'}" #etpFon />
      <div class="modified-label" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
        [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
        matTooltipHideDelay="0"
        *ngIf="paramsToAjust.param1.label===etpFon.id  || paramsToAjust.param2.label===etpFon.id" [@fadeInOut]>
        {{percentageModifiedInputText(etpFon.id,getFieldValue('etpFon',firstSituationData))}}%
        <div class="triangle"></div>
      </div>
    </div>
    <div [ngClass]="{'hide-by-category': !canViewContractuel}" class="line-item">
      <input class="ajusted-button disable" id="etpCont" [class.filled]="etpCont.value!=='Ajuster'"
        (click)="openPopupWithParams(etpCont)" value="Ajuster" readonly="readonly" #etpCont />
      <div class="modified-label" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
        [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
        matTooltipHideDelay="0"
        *ngIf="paramsToAjust.param1.label===etpCont.id  || paramsToAjust.param2.label===etpCont.id" [@fadeInOut]>
        {{percentageModifiedInputText(etpCont.id,getFieldValue('etpCont',firstSituationData))}}%

        <div class="triangle"></div>
      </div>
    </div>
    <div class="line-item blue-bg">
      <input class="ajusted-button" id="realCoverage" [class.filled]="realCoverage.value!=='Ajuster'"
        (click)="openPopupWithParams(realCoverage)" value="Ajuster" readonly="readonly" #realCoverage />
      <div class="modified-label" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
        [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
        matTooltipHideDelay="0"
        *ngIf="paramsToAjust.param1.label===realCoverage.id  || paramsToAjust.param2.label===realCoverage.id"
        [@fadeInOut]>
        {{percentageModifiedInputText(realCoverage.id,getFieldValue('realCoverage',firstSituationData))}}pts
        <div class="triangle"></div>
      </div>
    </div>
    <div class="line-item">
      <input class="ajusted-button" id="realDTESInMonths" [class.filled]="realDTESInMonths.value!=='Ajuster'"
        (click)="openPopupWithParams(realDTESInMonths)" value="Ajuster" readonly="readonly" #realDTESInMonths />
      <div class="modified-label" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
        [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
        matTooltipHideDelay="0"
        *ngIf="paramsToAjust.param1.label===realDTESInMonths.id  || paramsToAjust.param2.label===realDTESInMonths.id"
        [@fadeInOut]>
        {{percentageModifiedInputText(realDTESInMonths.id,getFieldValue('realDTESInMonths',firstSituationData))}}%

        <div class="triangle"></div>
      </div>
    </div>
    <div class="line-item blue-bg">
      <input class="ajusted-button" id="magRealTimePerCase" [class.filled]="magRealTimePerCase.value!=='Ajuster'"
        (click)="openPopupWithParams(magRealTimePerCase)" value="Ajuster" readonly="readonly" #magRealTimePerCase />
      <div class="modified-label" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
        [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
        matTooltipHideDelay="0"
        *ngIf="paramsToAjust.param1.label===magRealTimePerCase.id  || paramsToAjust.param2.label===magRealTimePerCase.id"
        [@fadeInOut]>
        {{percentageModifiedInputText(magRealTimePerCase.id,getFieldValue('magRealTimePerCase',firstSituationData,true))}}%
        <div class="triangle"></div>
      </div>
    </div>
  </div>

  <div class="simulation-bottom" *ngIf="toDisplaySimulation && hasNoNullValue(firstSituationData)"
    [ngClass]="{'hide': whiteSimulator === true}">
    <p class="simulation-title">Résultat de la simulation</p>
    <div class="simulation-table">
      <div class="items">
        <div class="item blue-bg">
          <p>Entrées mensuelles</p>
        </div>
        <div class="item">
          <p>Sorties mensuelles</p>
        </div>
        <div class="item blue-bg">
          <p>Stock</p>
        </div>
        <div *ngIf="canViewMagistrat" class="item">
          <p>ETPT magistrat</p>
        </div>
        <div *ngIf="canViewGreffier" class="item blue-bg">
          <p>ETPT greffe</p>
        </div>
        <div *ngIf="canViewContractuel" class="item">
          <p>ETPT contractuels</p>
        </div>
        <div class="item blue-bg">
          <p>Taux de couverture</p>
        </div>
        <div class="item">
          <p>DTES</p>
        </div>
        <div class="item blue-bg">
          <p>Temps moyen / dossier</p>
        </div>
      </div>
    </div>

    <div class="simulation-situation"
      *ngIf="subList.length!==0 || this.getElementById(this.contentieuId)?.childrens?.length===0" [@fadeInOut]>
      <div class="line-title">
        <p>
          Situation simulée<br />
          au {{stopRealValue}}
        </p>
      </div>
      <div class="item-container">
        <div class="line-item" #tooltip="matTooltip"
          [matTooltip]="'Valeur exacte d\'entrées utilisée dans les calculs : '+ trunc('totalIn',simulatedSationData,false,true)"
          matTooltipPosition="left" matTooltipShowDelay="0" matTooltipHideDelay="0">
          <input [value]="getFieldValue('totalIn',simulatedSationData)" disabled />
          <div class="modified-label simulated" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
            matTooltipHideDelay="0"
            *ngIf="paramsToAjust.param1.label==='totalIn'  || paramsToAjust.param2.label==='totalIn'" [@fadeInOut]>
            {{percentageModifiedInputText('totalIn',getFieldValue('totalIn',firstSituationData))}}%

            <div class="triangle simulated"></div>
          </div>
          <div class="modified-label simulated blue" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            matTooltipPosition="left" matTooltipShowDelay="0" matTooltipHideDelay="0"
            *ngIf="!(paramsToAjust.param1.label==='totalIn'  || paramsToAjust.param2.label==='totalIn') && getFieldValue('totalIn',simulatedSationData)!==getFieldValue('totalIn',firstSituationData)"
            [@fadeInOut]>
            {{ratio(getFieldValue('totalIn',simulatedSationData),getFieldValue('totalIn',firstSituationData))}}%

            <div class="triangle simulated blue"></div>
          </div>
        </div>
        <div class="line-item">
          <input [value]="getFieldValue('totalOut',simulatedSationData)" disabled />
          <div class="modified-label simulated" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
            matTooltipHideDelay="0"
            *ngIf="paramsToAjust.param1.label==='totalOut'  || paramsToAjust.param2.label==='totalOut'" [@fadeInOut]>
            {{percentageModifiedInputText('totalOut',getFieldValue('totalOut',firstSituationData))}}%

            <div class="triangle simulated"></div>
          </div>
          <div class="modified-label simulated blue" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            matTooltipPosition="left" matTooltipShowDelay="0" matTooltipHideDelay="0"
            *ngIf="!(paramsToAjust.param1.label==='totalOut'  || paramsToAjust.param2.label==='totalOut') && getFieldValue('totalOut',simulatedSationData)!==getFieldValue('totalOut',firstSituationData)"
            [@fadeInOut]>
            {{ratio(getFieldValue('totalOut',simulatedSationData),getFieldValue('totalOut',firstSituationData))}}%

            <div class="triangle simulated blue"></div>
          </div>
        </div>
        <div class="line-item">
          <input [value]="getFieldValue('lastStock',simulatedSationData)" disabled />
          <div class="modified-label simulated" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
            matTooltipHideDelay="0"
            *ngIf="paramsToAjust.param1.label==='lastStock'  || paramsToAjust.param2.label==='lastStock'" [@fadeInOut]>
            {{percentageModifiedInputText('lastStock',getFieldValue('lastStock',firstSituationData))}}%

            <div class="triangle simulated"></div>
          </div>
          <div class="modified-label simulated blue" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            matTooltipPosition="left" matTooltipShowDelay="0" matTooltipHideDelay="0"
            *ngIf="!(paramsToAjust.param1.label==='lastStock'  || paramsToAjust.param2.label==='lastStock') && getFieldValue('lastStock',simulatedSationData)!==getFieldValue('lastStock',firstSituationData)"
            [@fadeInOut]>
            {{ratio(getFieldValue('lastStock',simulatedSationData),getFieldValue('lastStock',firstSituationData))}}%

            <div class="triangle simulated blue"></div>
          </div>
        </div>
        <div *ngIf="canViewMagistrat" class="line-item">
          <input [value]="getFieldValue('etpMag',simulatedSationData)" disabled />
          <div class="modified-label simulated" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
            matTooltipHideDelay="0"
            *ngIf="paramsToAjust.param1.label==='etpMag'  || paramsToAjust.param2.label==='etpMag'" [@fadeInOut]>
            {{percentageModifiedInputText('etpMag',getFieldValue('etpMag',firstSituationData))}}%

            <div class="triangle simulated"></div>
          </div>
          <div class="modified-label simulated blue" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            matTooltipPosition="left" matTooltipShowDelay="0" matTooltipHideDelay="0"
            *ngIf="!(paramsToAjust.param1.label==='etpMag'  || paramsToAjust.param2.label==='etpMag') && getFieldValue('etpMag',simulatedSationData)!==getFieldValue('etpMag',firstSituationData)"
            [@fadeInOut]>
            {{ratio(getFieldValue('etpMag',simulatedSationData),getFieldValue('etpMag',firstSituationData))}}%

            <div class="triangle simulated blue"></div>
          </div>
        </div>
        <div *ngIf="canViewGreffier" class="line-item">
          <input [value]="getFieldValue('etpFon',simulatedSationData)" disabled />
          <div class="modified-label simulated" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
            matTooltipHideDelay="0"
            *ngIf="paramsToAjust.param1.label==='etpFon'  || paramsToAjust.param2.label==='etpFon'" [@fadeInOut]>
            {{percentageModifiedInputText('etpFon',getFieldValue('etpFon',firstSituationData))}}%

            <div class="triangle simulated"></div>
          </div>
          <div class="modified-label simulated blue" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            matTooltipPosition="left" matTooltipShowDelay="0" matTooltipHideDelay="0"
            *ngIf="!(paramsToAjust.param1.label==='etpFon'  || paramsToAjust.param2.label==='etpFon') && getFieldValue('etpFon',simulatedSationData)!==getFieldValue('etpFon',firstSituationData)"
            [@fadeInOut]>
            {{ratio(getFieldValue('etpFon',simulatedSationData),getFieldValue('etpFon',firstSituationData))}}%

            <div class="triangle simulated blue"></div>
          </div>
        </div>
        <div *ngIf="canViewContractuel" class="line-item">
          <input [value]="getFieldValue('',simulatedSationData)" disabled />
        </div>
        <div class="line-item">
          <input [value]="getFieldValue('realCoverage',simulatedSationData)" disabled />
          <div class="modified-label simulated" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
            matTooltipHideDelay="0"
            *ngIf="paramsToAjust.param1.label==='realCoverage'  || paramsToAjust.param2.label==='realCoverage'"
            [@fadeInOut]>
            {{percentageModifiedInputText('realCoverage',getFieldValue('realCoverage',firstSituationData))}}pts

            <div class="triangle simulated"></div>
          </div>
          <div class="modified-label simulated blue" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            matTooltipPosition="left" matTooltipShowDelay="0" matTooltipHideDelay="0"
            *ngIf="!(paramsToAjust.param1.label==='realCoverage'  || paramsToAjust.param2.label==='realCoverage') && getFieldValue('realCoverage',simulatedSationData)!==getFieldValue('realCoverage',firstSituationData)"
            [@fadeInOut]>
            {{calculCoverage(parseFloat(getFieldValue('realCoverage',simulatedSationData)),parseFloat(getFieldValue('realCoverage',firstSituationData)))>=
            0 ? '+' +
            calculCoverage(parseFloat(getFieldValue('realCoverage',simulatedSationData)),parseFloat(getFieldValue('realCoverage',firstSituationData)))
            :
            calculCoverage(parseFloat(getFieldValue('realCoverage',simulatedSationData)),parseFloat(getFieldValue('realCoverage',firstSituationData)))
            }}pts

            <div class="triangle simulated blue"></div>
          </div>
        </div>
        <div class="line-item">
          <input [value]="getFieldValue('realDTESInMonths',simulatedSationData)" disabled />
          <div class="modified-label simulated" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
            matTooltipHideDelay="0"
            *ngIf="paramsToAjust.param1.label==='realDTESInMonths'  || paramsToAjust.param2.label==='realDTESInMonths'"
            [@fadeInOut]>
            {{percentageModifiedInputText('realDTESInMonths',getFieldValue('realDTESInMonths',firstSituationData))}}%

            <div class="triangle simulated"></div>
          </div>
          <div class="modified-label simulated blue" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            matTooltipPosition="left" matTooltipShowDelay="0" matTooltipHideDelay="0"
            *ngIf="!(paramsToAjust.param1.label==='realDTESInMonths'  || paramsToAjust.param2.label==='realDTESInMonths') && getFieldValue('realDTESInMonths',simulatedSationData)!==getFieldValue('realDTESInMonths',firstSituationData)"
            [@fadeInOut]>
            {{ratio(getFieldValue('realDTESInMonths',simulatedSationData),getFieldValue('realDTESInMonths',firstSituationData))}}%

            <div class="triangle simulated blue"></div>
          </div>
        </div>
        <div class="line-item">
          <input [value]="getFieldValue('magRealTimePerCase',simulatedSationData)" disabled />
          <div class="modified-label simulated" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            [matTooltipClass]="{'tooltip-orange':true}" matTooltipPosition="left" matTooltipShowDelay="0"
            matTooltipHideDelay="0"
            *ngIf="paramsToAjust.param1.label==='magRealTimePerCase'  || paramsToAjust.param2.label==='magRealTimePerCase'"
            [@fadeInOut]>
            {{percentageModifiedInputText('magRealTimePerCase',getFieldValue('magRealTimePerCase',firstSituationData,true))}}%

            <div class="triangle simulated"></div>
          </div>
          <div class="modified-label simulated blue" #tooltip="matTooltip" [matTooltip]="getTooltipText()"
            matTooltipPosition="left" matTooltipShowDelay="0" matTooltipHideDelay="0"
            *ngIf="!(paramsToAjust.param1.label==='magRealTimePerCase'  || paramsToAjust.param2.label==='magRealTimePerCase') && getFieldValue('magRealTimePerCase',simulatedSationData)!==getFieldValue('magRealTimePerCase',firstSituationData)"
            [@fadeInOut]>
            {{ratio(getFieldValue('magRealTimePerCase',simulatedSationData,true,true),getFieldValue('magRealTimePerCase',firstSituationData,true,true))}}%
            <div class="triangle simulated blue"></div>
          </div>
        </div>
      </div>
    </div>
    <aj-dtes-chart></aj-dtes-chart>

    <aj-etp-chart *ngIf="categorySelected" [categorySelected]="categorySelected" [canViewMagistrat]="canViewMagistrat"
      [canViewGreffier]="canViewGreffier" [canViewContractuel]="canViewContractuel"></aj-etp-chart>

    <aj-in-out-chart></aj-in-out-chart>

    <div class="widgets">
      <aj-loaders-widget [dateStart]="startRealValue" [dateStop]="stopRealValue" [print]="onPrint"
        [valueAt]="getFieldValue('realDTESInMonths',firstSituationData)"
        [valueProjected]="getFieldValue('realDTESInMonths',projectedSituationData)"
        [valueSimulated]="getFieldValue('realDTESInMonths',simulatedSationData)"></aj-loaders-widget>
      <aj-figures-widget [dateStart]="startRealValue" [dateStop]="stopRealValue" [print]="onPrint"
        [valueAt]="getFieldValue('magRealTimePerCase',firstSituationData)"
        [valueProjected]="getFieldValue('magRealTimePerCase',projectedSituationData)"
        [valueSimulated]="getFieldValue('magRealTimePerCase',simulatedSationData)"></aj-figures-widget>
      <aj-dial-widget [dateStart]="startRealValue" [dateStop]="stopRealValue" [print]="onPrint"
        [valueProjected]="getFieldValue('realCoverage',projectedSituationData)"
        [valueSimulated]="getFieldValue('realCoverage',simulatedSationData)"></aj-dial-widget>
    </div>
    <div class="comment-row">
      <div class="space"></div>
      <div class="comment">
        <div class="header-comment">
          <p><b>Notes et commentaires</b><br /></p>
        </div>
        <textarea id="comment-area" #commentaireSimulateur placeholder="Commentaire"
          (keyup)="setComment($event)"></textarea>
        <div id="comment-area-copy">{{commentaire}}</div>
      </div>
      <div class="space"></div>
    </div>
  </div>

  <div class="white-date-selector" [ngClass]="{'hide': whiteSimulator === false}">
    <p>Selectionner une date de début et une date de fin :</p>
    <aj-date-select-blue class="select-disabled" [value]="dateStart"
      (valueChange)="whiteDateSelector('dateStart', $event)" [max]="dateStop" [min]="today">
    </aj-date-select-blue>
    <aj-date-select-blue [title]="'Fin de période'" [value]="dateStop"
      (valueChange)="whiteDateSelector('dateStop', $event)" [min]="getMin()" [side]="'right'">
    </aj-date-select-blue>
  </div>

  <div class="white-begin-situation" [ngClass]="{'hide': whiteSimulator === false}">
    <div class="items before-after">
      <div class="item blue-bg">
        <p>Entrées</p>
      </div>
      <div class="item">
        <p>Sorties</p>
      </div>
      <div class="item blue-bg">
        <p>Stock</p>
      </div>
      <div *ngIf="canViewMagistrat" class="item">
        <p>ETPT mag</p>
      </div>
      <div *ngIf="canViewGreffier" class="item blue-bg">
        <p>ETPT greffe</p>
      </div>
      <div *ngIf="canViewContractuel" class="item">
        <p>ETPT cont</p>
      </div>
      <div class="item blue-bg">
        <p>Taux de couverture</p>
      </div>
      <div class="item">
        <p>DTES</p>
      </div>
      <div class="item blue-bg">
        <p>Temps moyen / dossier</p>
      </div>
      <div class="item">
        <p></p>
      </div>
    </div>

    <div class="white-date-selector situation-white">
      <div class="actual-situation" [@fadeInOut]>
        <div class="line-title">
          <p>
            Situation de début (à compléter)
          </p>
        </div>

        <div class="line-item orange-bg">
          <input #whiteIn [value]="whiteSimulationBegin.totalIn" (valueChange)="updateWhiteValue('totalIn',$event)" />
        </div>
        <div class="line-item">
          <input #whiteOut [value]="whiteSimulationBegin.totalOut" />
        </div>
        <div class="line-item orange-bg">
          <input #whiteStock [value]="whiteSimulationBegin.lastStock" />
        </div>
        <div *ngIf="canViewMagistrat" class="line-item">
          <input #whiteEtpMag />
        </div>
        <div *ngIf="canViewGreffier" class="line-item grey-bg-disabled"
          [ngClass]="{'selected': categorySelected === 'FONCTIONNAIRE'}">
          <input [value]="getFieldValue('etpFon',firstSituationData)" disabled />
        </div>
        <div *ngIf="canViewContractuel" class="line-item grey-bg-disabled">
          <input [value]="getFieldValue('etpCont',firstSituationData)" disabled />
        </div>
        <div class="line-item grey-bg-disabled">
          <input [value]="getFieldValue('realCoverage',firstSituationData)" disabled />
        </div>
        <div class="line-item grey-bg-disabled">
          <input [value]="getFieldValue('realDTESInMonths',firstSituationData)" disabled />
        </div>
        <div class="line-item grey-bg-disabled">
          <input [value]="getFieldValue('magRealTimePerCase',firstSituationData)" disabled />
        </div>
        <div class="line-item" style="display:block; margin: auto;">
          <div class="validate-button" (click)="validateWhiteSimulator()">
            Valider
          </div>
          <div class="edit-button">
            Editer</div>
        </div>
      </div>
    </div>
  </div>

  <div class="white-date-selector" [ngClass]="{'hide': whiteSimulator === false}"
    style="display: flex;justify-content: center;">
    <div
      style="background-color: #000091; height: 28px; margin: 0px 8px; border-radius: 6px; color:white; padding: 0px 6px;">
      Simuler
    </div>
  </div>

</aj-wrapper>
<ng-template #actions>
  <div id="print-title">
    <img src="/assets/icons/logos/white-192x192@1x.svg" class="logo-ajust" width="80px" height="66px" />

    <p class="title">{{printTitle}}</p>
  </div>

  <div class="white-simulator enable" (click)="resetParams();whiteSimulator=!whiteSimulator;">
    <p class="title">Simuler à blanc</p>
  </div>

  <div id="export-button" class="export-button" [class.enable]="toDisplaySimulation" (click)="print()">
    <mat-icon class="shape">save</mat-icon>
    <p class="title">Exporter en PDF</p>
  </div>

  <div id="main-init" class="reset-button {{disabled}}" (click)="resetParams()">
    <p class="title">Reset</p>
  </div>
</ng-template>