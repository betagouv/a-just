<aj-wrapper title="Simulateur" [actionTemplate]="actions" [alignLeft]="true">
    <div class="top-bar-container">
        <p>Période choisie :</p>
        <div class="container-timeline">
            <div class="container-timeline-button">
                <aj-date-select-blue
                    class="select-disabled {{mooveClass}} {{disabled}}"
                    [value]="dateStart"
                    (valueChange)="updateReferentielSelected('dateStart', $event)"
                    [max]="dateStop"
                    [min]="today"
                >
                </aj-date-select-blue>
                <div class="space"></div>
                <aj-date-select-blue
                    class="{{disabled}}"
                    [title]="'Fin de période'"
                    [value]="dateStop"
                    (valueChange)="updateReferentielSelected('dateStop', $event)"
                    [min]="getMin()"
                    [side]="'right'"
                >
                </aj-date-select-blue>
            </div>
            <div class="Rectangle">
                <div class="dot {{mooveClass}}"></div>
                <div class="blue-line {{mooveClass}}"></div>
            </div>
        </div>
    </div>
    <div class="items">
        <div class="item blue-bg">
            <p>Entrées mensuelles</p>
        </div>
        <div class="item">
            <p>Sorties mensuelles</p>
        </div>
        <div class="item blue-bg">
            <p>Stock</p>
        </div>
        <div class="item">
            <p>ETPT magistrat</p>
        </div>
        <div class="item blue-bg">
            <p>ETPT greffe</p>
        </div>
        <div class="item">
            <p>ETPT contractuels</p>
        </div>
        <div class="item blue-bg">
            <p>Taux de couverture</p>
        </div>
        <div class="item">
            <p>DTES</p>
        </div>
        <div class="item blue-bg">
            <p>Temps moyen / dossier</p>
        </div>
    </div>
    <div
        class="actual-situation"
        *ngIf="subList.length!==0 || this.getElementById(this.contentieuId)?.childrens?.length===0"
        [@fadeInOut]
    >
        <div class="line-title">
            <p>
                Situation{{startRealValue? ' au':''}}<br />
                {{startRealValue || "à aujourd'hui"}}
            </p>
        </div>

        <div class="line-item orange-bg">
            <input
                [value]="getFieldValue('totalIn',firstSituationData)"
                disabled
            />
        </div>
        <div class="line-item">
            <input
                [value]="getFieldValue('totalOut',firstSituationData)"
                disabled
            />
        </div>
        <div class="line-item orange-bg">
            <input
                [value]="getFieldValue('lastStock',firstSituationData)"
                disabled
            />
        </div>
        <div class="line-item">
            <input
                [value]="getFieldValue('etpMag',firstSituationData)"
                disabled
            />
        </div>
        <div class="line-item orange-bg">
            <input
                [value]="getFieldValue('ETPTGreffe',firstSituationData)"
                disabled
            />
        </div>
        <div class="line-item">
            <input
                [value]="getFieldValue('etpFon',firstSituationData)"
                disabled
            />
        </div>
        <div class="line-item orange-bg">
            <input
                [value]="getFieldValue('realCoverage',firstSituationData)"
                disabled
            />
        </div>
        <div class="line-item">
            <input
                [value]="getFieldValue('realDTESInMonths',firstSituationData)"
                disabled
            />
        </div>
        <div class="line-item orange-bg">
            <input
                [value]="getFieldValue('realTimePerCase',firstSituationData)"
                disabled
            />
        </div>
    </div>

    <div
        class="actual-situation color-blue"
        *ngIf="dateStop!==null"
        [@fadeInOut]
    >
        <div class="line-title">
            <p>
                Situation projetée<br />
                au {{stopRealValue}}
            </p>
        </div>

        <div class="line-item grey-bg">
            <input
                [value]="getFieldValue('totalIn',projectedSituationData)"
                disabled
            />
        </div>
        <div class="line-item">
            <input
                [value]="getFieldValue('totalOut',projectedSituationData)"
                disabled
            />
        </div>
        <div class="line-item grey-bg">
            <input
                [value]="getFieldValue('lastStock',projectedSituationData)"
                disabled
            />
        </div>
        <div class="line-item">
            <input
                [value]="getFieldValue('etpMag',projectedSituationData)"
                disabled
            />
        </div>
        <div class="line-item grey-bg">
            <input
                [value]="getFieldValue('ETPTGreffe',projectedSituationData)"
                disabled
            />
        </div>
        <div class="line-item">
            <input
                [value]="getFieldValue('etpFon',projectedSituationData)"
                disabled
            />
        </div>
        <div class="line-item grey-bg">
            <input
                [value]="getFieldValue('realCoverage',projectedSituationData)"
                disabled
            />
        </div>
        <div class="line-item">
            <input
                [value]="getFieldValue('realDTESInMonths',projectedSituationData)"
                disabled
            />
        </div>
        <div class="line-item grey-bg">
            <input
                [value]="getFieldValue('realTimePerCase',projectedSituationData)"
                disabled
            />
        </div>
    </div>

    <div
        class="actual-situation color-white"
        *ngIf="dateStop!==null"
        [@fadeInOut]
    >
        <div class="line-title">
            <p>
                Modifier<br />
                des paramètres
            </p>
        </div>

        <div class="line-item blue-bg">
            <div class="ajusted-button" (click)="printConsole($event)" #Entrée>
                <p class="title">Ajuster</p>
            </div>
        </div>
        <div class="line-item">
            <div class="ajusted-button">
                <p class="title">Ajuster</p>
            </div>
        </div>
        <div class="line-item blue-bg">
            <div class="ajusted-button">
                <p class="title">Ajuster</p>
            </div>
        </div>
        <div class="line-item">
            <input
                class="ajusted-button"
                id="ETPT"
                [class.filled]="ETPT.value!=='Ajuster'"
                (click)="printConsole(ETPT)"
                value="Ajuster"
                readonly="readonly"
                #ETPT
            />

            <aj-popup
                *ngIf="openPopup===true"
                [actions]="[
    { id: 'modify', content: 'Ajuster', fill: true }
  ]"
                [closeIcon]="true"
                (onClose)="openPopup = false"
                [removeShadow]="'noShadow'"
                (selectedAction)="doSomething($event,volume.value,ETPT)"
            >
                <div id="circle">
                    <img src="/assets/icons/stock.svg" />
                </div>
                <p>Ajustement {{currentNode?.popupTitle}}</p>

                <div class="rectangle">
                    <div class="title">
                        Atteindre au {{stopRealValue}} <br />
                        {{currentNode?.toDefine[0]}} :
                    </div>
                    <input
                        type="number"
                        (oninput)="onUpdateValue($event)"
                        (focusin)="resetPercentage = true"
                        (focusout)="resetPercentage = false"
                        value="{{paramsToAjust.param1.input ===1?paramsToAjust.param1.value:''}}"
                        #volume
                    />
                </div>
                <div class="rectangle">
                    <div class="title">
                        Définir {{currentNode?.toDefine[1]}} :<br />
                        <span
                            >(en % par rapport à la situation {{startRealValue?
                            'au' : "d'"}}
                            {{startRealValue||"aujourd'hui"}})</span
                        >
                    </div>
                    <aj-input-percentage
                        (focusin)="volume.value = ''"
                        [referenceValue]="3000"
                        [reset]="resetPercentage"
                        [defaultValue]="paramsToAjust.param1.input ===2 ? paramsToAjust.param1.value : null"
                        (valueChange)="onUpdateValue($event)"
                    ></aj-input-percentage>
                </div>
            </aj-popup>
        </div>
        <div class="line-item blue-bg">
            <div class="ajusted-button">
                <p class="title">Ajuster</p>
            </div>
        </div>
        <div class="line-item">
            <div class="ajusted-button">
                <p class="title">Ajuster</p>
            </div>
        </div>
        <div class="line-item blue-bg">
            <div class="ajusted-button">
                <p class="title">Ajuster</p>
            </div>
        </div>
        <div class="line-item">
            <div class="ajusted-button">
                <p class="title">Ajuster</p>
            </div>
        </div>
        <div class="line-item blue-bg">
            <div class="ajusted-button">
                <p class="title">Ajuster</p>
            </div>
        </div>
    </div>
    <div class="options" *ngIf="dateStop!==null" [@fadeInOut]>
        <div class="init-button">
            <p class="title">Réinitialiser</p>
        </div>
        <div class="simulate-button">
            <p class="title">Simuler</p>
        </div>
    </div>
</aj-wrapper>
<ng-template #actions>
    <aj-select
        title="Contentieux"
        class="contentieux {{disabled}}"
        [defaultRealValue]="'Sélectionner un contentieux'"
        [value]="contentieuId"
        [datas]="formReferentiel"
        (valueChange)="updateReferentielSelected('referentiel', $event)"
        [multiple]="false"
    >
    </aj-select>
    <aj-select
        title="Sous Contentieux"
        class="{{disabled}}"
        [class.notSelectable]="contentieuId===null"
        [value]="subList"
        [datas]="formReferentiel"
        [subList]="subList"
        [parent]="contentieuId"
        (valueChange)="updateReferentielSelected('subList', $event)"
    >
    </aj-select>
    <div class="reset-button {{disabled}}" (click)="resetParams()">
        <p class="title">Reset</p>
    </div>
    <div class="export-button">
        <div class="shape">D</div>
        <p class="title">Exporter en PDF</p>
    </div>
</ng-template>
