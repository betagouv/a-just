<!--
<app-avarage-etp-displayer></app-avarage-etp-displayer>
-->
<aj-wrapper #wrapper title="R√©f√©rentiels de temps moyens" [documentation]="documentation"
  class="content-margin-null title-margin-right-null title-margin-top-null title-margin-bottom-null large-actions"
  [actionTemplate]="ressources" [alignLeft]="false">

  <!-- POPUP CREATION -->
  <aj-popup *ngIf="onCreation===true" [closeIcon]="true"
    (onClose)="onCreation = false;nameLength = 0; openedFromCockpit=false" [removeShadow]="'noShadow'"
    class="border-radius fix-width-400">
    <div id="circle">
      <i class="ri-ball-pen-line"></i>
    </div>
    <p>Quel sera le nom du r√©f√©rentiel ?</p>
    <label class="max-char">{{nameLength}} / 48 caract√®res maximum</label>
    <div class="container">
      <textarea id="name" #name placeholder="Saisir un nom" maxlength="48" (keyup)="countLen(name.value)"></textarea>
    </div>
    <div class="container radio">
      Appliqu√© au
      <button id="type" #type class="radio-button" name="{{this.canViewMagistrat?'SIEGE':'GREFFE'}}">
        <label *ngIf="this.canViewMagistrat" class="left" (click)="type.value = 'SIEGE';type.name = 'SIEGE'"
          [ngClass]="{'selected-mag':type.name=== 'SIEGE'}">Si√®ge</label>
        <label *ngIf="this.canViewGreffier" class="right" (click)="type.value = 'Greffe';type.name = 'GREFFE'"
          [ngClass]="{'selected-greffe':type.name=== 'GREFFE'}">Greffe</label>
      </button>
    </div>

    <button *ngIf="onUpload" mat-menu-item (click)="openFilePicker();$event.stopPropagation();">
      <div class="form">
        <form id="form" #formAllActivities>
          <div>
            <label class="custom-file-upload pointer-events-none">
              <input id="filePicker" name="file" type="file" accept=".xlsx" class="pointer-events-none"
                (change)="onSendAllActivity(formAllActivities)" (click)="$event.stopPropagation();" />
            </label>
          </div>
        </form>
      </div>
    </button>

    <div class="actions">
      <div *ngIf="onUpload" [ngClass]="{'enable': enableImport===true}" class="save" (click)="import()">Importer</div>
      <div *ngIf="!onUpload" class="save enable" (click)="create(name.value,type.name)">Enregistrer</div>
    </div>
  </aj-popup>


  <!-- POPUP SUPPRESSION -->
  <aj-popup *ngIf="onDelete===true" [closeIcon]="true" (onClose)="onDelete = false" [removeShadow]="'noShadow'"
    class="border-radius width-500">
    <div id="circle">
      <i class="ri-delete-bin-6-line"></i>
    </div>
    <p>Supprimer ce r√©f√©rentiel</p>
    <div class="text">
      Vous vous appr√©tez √† supprimer ce r√©f√©rentiel. Cela entrainera la suppression de l‚Äôensemble des donn√©es
      renseign√©es.
      <label class="follow">üëâ Souhaitez vous poursuivre ?</label>
    </div>
    <div class="actions">
      <div class="back" (click)="onDelete = false">Annuler</div>
      <div class="save" (click)="remove()">Supprimer</div>
    </div>
  </aj-popup>

  <div class="sticky-bar">
    <div class="action-bar">
      <label>R√©f√©rentiels</label>
      <div class="flex-1"></div>
      <div class="delete-action">
        <i class="ri-delete-bin-6-line"></i>
        <label (click)="onRemove()">Supprimer</label>
      </div>
      <div class="import-action" (click)="onCreation=true;onUpload=true">Importer un r√©f√©rentiel</div>
      <div class="create-action" (click)="onCreation=true;onUpload=false">Cr√©er un r√©f√©rentiel</div>
    </div>

    <div class="header-bar">
      <aj-checkbox class="black" (valueChange)="checkAll($event)" [value]="checkAll()"></aj-checkbox>
      <label class="name">Nom</label>
      <label class="apply">Appliqu√© au</label>
      <label class="create">Date de cr√©ation</label>
      <label class="modify">Derni√®re modification</label>
      <label class="status">Statut</label>
      <div class="actions"></div>
    </div>
  </div>


  <div class="line-item" *ngFor="let backup of backups; index as i;" (click)="goTo(backup.id)">
    <aj-checkbox [(value)]="checkList[i]" (click)="$event.stopPropagation()"></aj-checkbox>
    <label class="name">{{backup.label}}</label>
    <div class="apply">
      <label class="tag" [ngStyle]="{'background-color': backup.type === 'GREFFE' ? '#fee7fc' : '#e3e3fd',
        'color': backup.type === 'GREFFE' ? '#a558a0':'#000091'}">{{backup.type === 'GREFFE'?'Greffe':'Si√®ge'}}
      </label>
    </div>
    <label class="create">{{realValue(backup.date)}}</label>
    <label class="modify">{{backup.update ? (backup.update.date|dateAgo) : ''}}</label>
    <div class="status">
      <label class="tag"
        [ngStyle]="{'background-color': backup.status==='Import√©' ? '#c3fad5' : '#dee5fd', 'color': backup.status==='Import√©'  ? '#00a95f':'#465f9d'}">{{backup.status==='Import√©'
        ?'Import√©':'Local'}}
      </label>
    </div>
    <div class="actions">
      <div class="rename" (click)="rename(backup.id);$event.stopPropagation()">
        <i class="ri-edit-line"></i>
        Renommer
      </div>
      <div class="duplicate" (click)="duplicate(backup.id,backup.type);$event.stopPropagation()">
        <i class="ri-file-copy-line"></i>
        Dupliquer
      </div>
    </div>
  </div>
</aj-wrapper>

<ng-template #ressources>
  <div class="top-right-header">
    <div class="flex-1"></div>
    <div class="right-panel">
      <h2>Ressources :</h2>
      <div class="elements">
        <div class="element" (click)="downloadAsset()">
          <p>
            T√©l√©charger un r√©f√©rentiel vierge
          </p>
          <img src="/assets/icons/download-line-blue.svg" />
        </div>
      </div>
    </div>
  </div>
</ng-template>