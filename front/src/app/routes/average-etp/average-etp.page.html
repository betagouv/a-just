<aj-wrapper title="Temps moyens" [actionTemplate]="actions" [isLoading]="isLoading">
    <div class="container">
        <div class="header-list">
            <div class="label month">Temps moyens / contentieux</div>
            <div class="column-item">
                <mat-button-toggle-group [value]="perUnity">
                    <mat-button-toggle value="hour" (click)="changeUnity('hour')">Temps moyen en heure
                    </mat-button-toggle>
                    <mat-button-toggle value="day" (click)="changeUnity('day')">Nombre de dossiers par jour
                    </mat-button-toggle>
                </mat-button-toggle-group>
            </div>
        </div>
        <div class="content-list">
            <div *ngFor="let ref of referentiel" class="item-grouped">
                <div class="item">
                    <div class="label">
                        <p>{{ref.label}}</p>
                        <button *ngIf="(ref.childrens || []).length"
                            (click)="ref.showOptionGroup = !ref.showOptionGroup" mat-icon-button>
                            <mat-icon>{{ ref.showOptionGroup ? 'expand_less' : 'expand_more'
                                }}</mat-icon>
                        </button>
                    </div>
                    <div class="column-item">
                        <app-time-selector *ngIf="perUnity === 'hour'"
                            [value]="ref.averageProcessingTime ? (perUnity === 'hour' ? ref.averageProcessingTime : fixDecimal(8 / ref.averageProcessingTime)) : 0"
                            (valueChange)="onUpdateOptions(ref, $event)"></app-time-selector>
                        <input *ngIf="perUnity !== 'hour'" type="number"
                            [ngModel]="ref.averageProcessingTime ? (perUnity === 'hour' ? ref.averageProcessingTime : fixDecimal(8 / ref.averageProcessingTime)) : ''"
                            (ngModelChange)="onUpdateOptions(ref, $event)" min="0" />

                        <p>
                            {{perUnity === 'hour' ? '&nbsp; temps moyen en heure:minute' :
                            'nombre de dossiers par jour'}}
                        </p>
                    </div>
                </div>
                <div class="group" [class.enable]="ref.showOptionGroup">
                    <div class="group-item" *ngFor="let itemGroup of (ref.childrens ||Â [])"
                        [style.borderColor]="referentielMappingColor(ref.label)">
                        <div class="label">
                            <p>{{itemGroup.label}}</p>
                        </div>
                        <div class="column-item">
                            <app-time-selector *ngIf="perUnity === 'hour'"
                                [value]="itemGroup.averageProcessingTime ? (perUnity === 'hour' ? itemGroup.averageProcessingTime : fixDecimal(8 / itemGroup.averageProcessingTime)) : 0"
                                (valueChange)="onUpdateOptions(itemGroup, $event)"></app-time-selector>
                            <input *ngIf="perUnity !== 'hour'" type="number"
                                [ngModel]="itemGroup.averageProcessingTime ? (perUnity === 'hour' ? itemGroup.averageProcessingTime : fixDecimal(8 / itemGroup.averageProcessingTime)) : ''"
                                (ngModelChange)="onUpdateOptions(itemGroup, $event)" min="0" />

                            <p>
                                {{perUnity === 'hour' ? '&nbsp; temps moyen en heure:minute' :
                                'nombre de dossiers par jour'}}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</aj-wrapper>

<ng-template #actions>
    <aj-options-backup-panel></aj-options-backup-panel>
</ng-template>