@if (calculator) {
<div class="main-referentiel" [style.backgroundColor]="
      userService.referentielMappingColorActivityByInterface(
        userService.referentielMappingNameByInterface(
          calculator.contentieux.label === 'Autres activités' ? 'other' : calculator.contentieux.label
        ),
        OPACITY
      )
    ">
  <div class="width-contentieux contentieux" (click)="onToggleChildren()">
    @if (calculator.childrens && calculator.childrens.length) {
    <mat-icon class="no-print">{{ showChildren ? 'expand_more' : 'chevron_right' }}</mat-icon>
    }
    <p>
      {{
      userService.isCa()
      ? calculator.contentieux.label
      : userService.referentielMappingNameByInterface(calculator.contentieux.label)
      }}
    </p>
  </div>
  <div [ngClass]="{ selected: sortBy === 'realDTESInMonths' }" class="item dtes">
    @if (!isSoutien(calculator.contentieux.id)) {
    <div class="block">
      @if (calculator.realDTESInMonths !== null && checkPastDate()) {
      @if (calculator.realCoverageBf !==null && calculator.realCoverageAf !== null && calculator.realCoverageBf
      > calculator.realCoverageAf) { <img src="/assets/icons/cockpit-down.svg" alt="cockpit-down"
        class="cockpit-down" />}
      @else { <img src="/assets/icons/cockpit-up.svg" alt="cockpit-up" class="cockpit-up" /> }
      <p>{{ calculator.realDTESInMonths | number: '0.2-2' }} mois</p>
      }
      @else {
      <div class="ref-nr">
        <aj-tooltips title="Donnée non renseignée" class="small"
          content="Chiffre non calculable à partir des données d’activité enregistrées à ce jour : si vous en disposez, veuillez les compléter dans l'écran “données d’activité”."></aj-tooltips>
        <p>N/R</p>
      </div>
      }
    </div>
    }
  </div>
  <div [ngClass]="{ selected: sortBy === 'realCoverage' }" class="item coverage">
    @if (!isSoutien(calculator.contentieux.id)) {
    <div class="block left-border">
      @if (checkPastDate() && calculator.totalOut !== null && calculator.totalIn !== null) {
      <aj-speedometer [percent]="round((calculator.realCoverage || 0) * 100)"></aj-speedometer>
      } @else {
      <div class="ref-nr">
        <aj-tooltips title="Donnée non renseignée" class="small"
          content="Chiffre non calculable à partir des données d’activité enregistrées à ce jour : si vous en disposez, veuillez les compléter dans l'écran “données d’activité”."></aj-tooltips>
        <p>N/R</p>
      </div>
      }
    </div>
    }
  </div>
  <div [ngClass]="{ selected: sortBy === 'lastStock' }" class="item stock">
    @if (!isSoutien(calculator.contentieux.id)) {
    @if (calculator.lastStock !== null && checkPastDate()) {
    <div>
      @if (calculator.totalOutBf !==null && calculator.totalOutAf !== null && calculator.totalOutBf
      > calculator.totalOutAf) { <img src="/assets/icons/cockpit-down.svg" alt="cockpit-down" class="cockpit-down" />}
      @else { <img src="/assets/icons/cockpit-up.svg" alt="cockpit-up" class="cockpit-up" /> }
      <p>{{ calculator.lastStock }}</p>
    </div>
    } @else {
    <div class="ref-nr">
      <aj-tooltips title="Donnée non renseignée" class="small"
        content="Chiffre non calculable à partir des données d’activité enregistrées à ce jour : si vous en disposez, veuillez les compléter dans l'écran “données d’activité”."></aj-tooltips>
      <p>N/R</p>
    </div>
    }
    }
  </div>
  @if (canViewMagistrat) {
  <div [ngClass]="{
          selected: sortBy === 'etpMag',
          'bg-magistrats': categorySelected === MAGISTRATS,
        }" class="left-border item">
    <div>
      <p>{{ calculator.etpMag | number: '0.2-2' }}</p>
    </div>
  </div>
  }
  @if (canViewGreffier) {
  <div [ngClass]="{
          selected: sortBy === 'etpFon',
          'bg-fonctionnaires': categorySelected === FONCTIONNAIRES,
        }" class="left-border item">
    <div>
      <p>{{ calculator.etpFon | number: '0.2-2' }}</p>
    </div>
  </div>
  }
  @if (canViewContractuel) {
  <div [ngClass]="{ selected: sortBy === 'etpCont' }" class="left-border item">
    <div>
      <p>{{ calculator.etpCont | number: '0.2-2' }}</p>
    </div>
  </div>
  }
</div>
}
@if ((showChildren || forceToShowChildren) && calculator && calculator.childrens && calculator.childrens.length) {
<div class="childrens">
  @for (r of calculator.childrens; track r.contentieux.id) {
  <aj-referentiel-calculator [calculator]="r" [sortBy]="sortBy" class="is-child"
    [categorySelected]="categorySelected"></aj-referentiel-calculator>
  }
</div>
}