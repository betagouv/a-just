@if (calculator) {
<div class="main-referentiel" [style.backgroundColor]="
      userService.referentielMappingColorActivityByInterface(
        userService.referentielMappingNameByInterface(
          calculator.contentieux.label === 'Autres activités' ? 'other' : calculator.contentieux.label
        ),
        OPACITY
      )
    ">
  <div (click)="onToggleChildren()">
    @if (calculator.childrens && calculator.childrens.length) {
    <mat-icon class="no-print">{{ showChildren ? 'expand_more' : 'chevron_right' }}</mat-icon>
    }
    <p>
      {{
      userService.isCa()
      ? calculator.contentieux.label
      : userService.referentielMappingNameByInterface(calculator.contentieux.label)
      }}
    </p>
    <div class="help">
      <span>?</span>
    </div>
  </div>
  <div [ngClass]="{'dtes': calculator.realDTESInMonths !== null && checkPastDate()}">
    @if (!isSoutien(calculator.contentieux.id)) {
    <div class="block">
      @if (calculator.realDTESInMonths !== null && checkPastDate()) {
      @if (calculator.realCoverageBf !==null && calculator.realCoverageAf !== null && calculator.realCoverageBf
      > calculator.realCoverageAf) { <img src="/assets/icons/cockpit-down.svg" alt="cockpit-down"
        class="cockpit-down" />}
      @else { <img src="/assets/icons/cockpit-up.svg" alt="cockpit-up" class="cockpit-up" /> }
      <p>{{ calculator.realDTESInMonths | number: '0.2-2' }} mois</p>
      }
      @else {
      <div class="ref-nr">
        <aj-tooltips title="Donnée non renseignée" class="small"
          content="Chiffre non calculable à partir des données d’activité enregistrées à ce jour : si vous en disposez, veuillez les compléter dans l'écran “données d’activité”."></aj-tooltips>
        <p>N/R</p>
      </div>
      }
    </div>
    }
  </div>
  <div>
    @if (!isSoutien(calculator.contentieux.id)) {
    <div class="block">
      @if (checkPastDate() && calculator.totalOut !== null && calculator.totalIn !== null) {
      <aj-speedometer [percent]="round((calculator.realCoverage || 0) * 100)"></aj-speedometer>
      } @else {
      <div class="ref-nr">
        <aj-tooltips title="Donnée non renseignée" class="small"
          content="Chiffre non calculable à partir des données d’activité enregistrées à ce jour : si vous en disposez, veuillez les compléter dans l'écran “données d’activité”."></aj-tooltips>
        <p>N/R</p>
      </div>
      }
    </div>
    }
  </div>
  <div [ngClass]="{'stock': calculator.lastStock !== null && checkPastDate()}">
    @if (!isSoutien(calculator.contentieux.id)) {
    @if (calculator.lastStock !== null && checkPastDate()) {
    <div class="block">
      @if (calculator.totalOutBf !==null && calculator.totalOutAf !== null && calculator.totalOutBf
      > calculator.totalOutAf) { <img src="/assets/icons/cockpit-down.svg" alt="cockpit-down" class="cockpit-down" />}
      @else { <img src="/assets/icons/cockpit-up.svg" alt="cockpit-up" class="cockpit-up" /> }
      <p>{{ calculator.lastStock }}</p>
    </div>
    } @else {
    <div class="ref-nr">
      <aj-tooltips title="Donnée non renseignée" class="small"
        content="Chiffre non calculable à partir des données d’activité enregistrées à ce jour : si vous en disposez, veuillez les compléter dans l'écran “données d’activité”."></aj-tooltips>
      <p>N/R</p>
    </div>
    }
    }
  </div>
  <div>
    @if(categoryIdSelected) {
    <p class="etpt-selected">
      @if(canViewMagistrat) {<span>{{ calculator.etpMag | number: '0.2-2' }}</span>}
      @if(canViewGreffier) {<span>{{ calculator.etpFon | number: '0.2-2' }}</span>}
      @if(canViewContractuel) {<span>{{ calculator.etpCont | number: '0.2-2' }}</span>}
    </p>}
    @else {
    @if(canViewMagistrat) {<p>{{ calculator.etpMag | number: '0.2-2' }}</p>}
    @else if(canViewGreffier) {<p>{{ calculator.etpFon | number: '0.2-2' }}</p>}
    @else if(canViewContractuel) {<p>{{ calculator.etpCont | number: '0.2-2' }}</p>}
    }
  </div>
  <div>
    <div class="anticipate" [ngStyle]="{ borderColor: userService.referentielMappingColorActivityByInterface(
            userService.referentielMappingNameByInterface(
              calculator.contentieux.label === 'Autres activités' ? 'other' : calculator.contentieux.label
            )
          ) }">
      <p [ngStyle]="{ color: userService.referentielMappingColorActivityByInterface(
            userService.referentielMappingNameByInterface(
              calculator.contentieux.label === 'Autres activités' ? 'other' : calculator.contentieux.label
            )
          ) }">Se projeter</p>
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
        <path d="M1.5 9.75H6V15.75H1.5V9.75ZM6.75 2.25H11.25V15.75H6.75V2.25ZM12 6H16.5V15.75H12V6Z" [attr.fill]="userService.referentielMappingColorActivityByInterface(
            userService.referentielMappingNameByInterface(
              calculator.contentieux.label === 'Autres activités' ? 'other' : calculator.contentieux.label
            )
          )" />
      </svg>
    </div>
  </div>
</div>
}
@if ((showChildren || forceToShowChildren) && calculator && calculator.childrens && calculator.childrens.length) {
<div class="childrens">
  @for (r of calculator.childrens; track r.contentieux.id) {
  <aj-referentiel-calculator [calculator]="r" [sortBy]="sortBy" class="is-child" [categorySelected]="categorySelected"
    [categoryFiltered]="categoryFiltered" [categoryIdSelected]="categoryIdSelected"></aj-referentiel-calculator>
  }
</div>
}