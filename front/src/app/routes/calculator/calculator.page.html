<aj-wrapper title="Calculateur" [actionTemplate]="actions" class="content-margin-null">
  <div class="container">
    <div class="header-calculator">
      <div class="title-header-calculator">
        <div class="width-contentieux"></div>
        <div class="item">
          <p>Données constatées</p>
        </div>
        <div class="item activity">
          <p>Activité constatée</p>
        </div>
        <div class="item calculate">
          <p>Activité calculée</p>
        </div>
      </div>
      <div class="explanation-calculator">
        <div class="width-contentieux"></div>
        <div class="item">
          <p>
            Données renseignées depuis les écrans
            <a routerLink="/ventilations">Affectation des ETP</a> et
            <a routerLink="/donnees-d-activite">Données d’activité</a>
          </p>
        </div>
        <div class="item activity">
          <p>Calculs effectués à partir des données constatées</p>
        </div>
        <div class="item calculate">
          <p>
            Calculs théoriques effectués à partir des temps moyens de
            comparaison sélectionnés dans « Mes temps moyens de comparaison »
          </p>
        </div>
      </div>
      <div class="contentieux-header-calculator" title="">
        <div class="width-contentieux">
          <p>Contentieux</p>
        </div>
        <div class="item">
          <div (click)="onSortBy('totalIn')" [ngClass]="{'selected': sortBy === 'totalIn'}">
            <p>Entrées</p>
            <div class="flex-1"></div>
            <mat-icon>{{ sortBy === 'totalIn' ? 'filter_list' : 'filter_list_off'
              }}</mat-icon>
            <aj-tooltips title="Entrées" content="Entrées moyennes mensuelles sur la période choisie"></aj-tooltips>
          </div>
          <div (click)="onSortBy('totalOut')" [ngClass]="{'selected': sortBy === 'totalOut'}">
            <p>Sorties</p>
            <div class="flex-1"></div>
            <mat-icon>{{ sortBy === 'totalOut' ? 'filter_list' : 'filter_list_off'
              }}</mat-icon>
            <aj-tooltips title="Sorties" content="Sorties moyennes mensuelles sur la période choisie"></aj-tooltips>
          </div>
          <div (click)="onSortBy('lastStock')" [ngClass]="{'selected': sortBy === 'lastStock'}">
            <p>Stock</p>
            <div class="flex-1"></div>
            <mat-icon>{{ sortBy === 'lastStock' ? 'filter_list' : 'filter_list_off'
              }}</mat-icon>
            <aj-tooltips title="Stock" content="Dossiers en stock à la fin de la période choisie"></aj-tooltips>
          </div>
          <div class="tooltip medium" (click)="onSortBy('etpMag')" [ngClass]="{'selected': sortBy === 'etpMag'}">
            <p>ETPT <br />Mag.</p>
            <div class="flex-1"></div>
            <mat-icon>{{ sortBy === 'etpMag' ? 'filter_list' : 'filter_list_off'
              }}</mat-icon>
            <aj-tooltips class="medium" title="ETPT mag."
              content="Total des ETP travaillés sur la période par les magistrats affectés à ce contentieux">
            </aj-tooltips>
          </div>
          <div class="tooltip medium" (click)="onSortBy('etpFon')" [ngClass]="{'selected': sortBy === 'etpFon'}">
            <p>ETPT<br />Greffe</p>
            <div class="flex-1"></div>
            <mat-icon>{{ sortBy === 'etpFon' ? 'filter_list' : 'filter_list_off'
              }}</mat-icon>
            <aj-tooltips class="medium" title="ETPT greffe"
              content="Total des ETP travaillés sur la période par les agents du greffe affectés à ce contentieux">
            </aj-tooltips>
          </div>
          <div class="tooltip medium" (click)="onSortBy('etpCont')" [ngClass]="{'selected': sortBy === 'etpCont'}">
            <p>ETPT<br />Cont.</p>
            <div class="flex-1"></div>
            <mat-icon>{{ sortBy === 'etpCont' ? 'filter_list' : 'filter_list_off'
              }}</mat-icon>
            <aj-tooltips class="medium" title="ETPT cont."
              content="Total des ETP travaillés sur la période par les agents contractuels affectés à ce contentieux">
            </aj-tooltips>
          </div>
        </div>
        <div class="item">
          <div (click)="onSortBy('realCoverage')" [ngClass]="{'selected': sortBy === 'realCoverage'}">
            <p>Taux de<br />couverture</p>
            <div class="flex-1"></div>
            <mat-icon>{{ sortBy === 'realCoverage' ? 'filter_list' : 'filter_list_off'
              }}</mat-icon>
            <aj-tooltips title="Taux de couverture" content="SORTIES /ENTREES de la période en %">
            </aj-tooltips>
          </div>
          <div (click)="onSortBy('realDTESInMonths')" [ngClass]="{'selected': sortBy === 'realDTESInMonths'}">
            <p>DTES<br />instantané</p>
            <div class="flex-1"></div>
            <mat-icon>{{ sortBy === 'realDTESInMonths' ? 'filter_list' :
              'filter_list_off' }}</mat-icon>
            <aj-tooltips title="DTES instantané" class="medium"
              content="Délai théorique d’écoulement du stock = temps moyen nécessaire au traitement de l’intégralité des affaires en stock compte tenu des sorties enregistrées pour la période antérieure."
              footer="Mode de calcul :<br/><b>STOCK/SORTIES</b>">
            </aj-tooltips>
          </div>
          <div class="tooltip large" (click)="onSortBy('realTimePerCase')"
            [ngClass]="{'selected': sortBy === 'realTimePerCase'}">
            <p>Tps moyen<br />/ dossier observé</p>
            <div class="flex-1"></div>
            <mat-icon>{{ sortBy === 'realTimePerCase' ? 'filter_list' :
              'filter_list_off' }}</mat-icon>
            <aj-tooltips title="Temps moyen par dossier observé" class="large"
              content="Temps moyen consacré au traitement d’un dossier par les ETPT affectés à ce contentieux sur la période."
              footer="Mode de calcul :<br/><b>NOMBRE_HEURES_TRAVAILLEES_PAR_MOIS_PAR_ETPT x ETPT MAG. /SORTIES</b>">
            </aj-tooltips>
          </div>
        </div>
        <div class="item">
          <div class="tooltip" (click)="onSortBy('calculateCoverage')"
            [ngClass]="{'selected': sortBy === 'calculateCoverage'}">
            <p>Taux de<br />couverture</p>
            <div class="flex-1"></div>
            <mat-icon>{{ sortBy === 'calculateCoverage' ? 'filter_list' :
              'filter_list_off' }}</mat-icon>
            <aj-tooltips title="Taux de couverture" class="medium"
              content="SORTIES possibles/ENTREES de la période en %">
            </aj-tooltips>
          </div>
          <div class="tooltip large last" (click)="onSortBy('calculateDTESInMonths')"
            [ngClass]="{'selected': sortBy === 'calculateDTESInMonths'}">
            <p>DTES<br />calculé</p>
            <div class="flex-1"></div>
            <mat-icon>{{ sortBy === 'calculateDTESInMonths' ? 'filter_list' :
              'filter_list_off' }}</mat-icon>
            <aj-tooltips title="DTES calculé" class="large left"
              content="Délai théorique d’écoulement du stock = temps moyen nécessaire au traitement de l’intégralité des affaires en stock compte tenu des sorties possibles sur la période."
              footer="Mode de calcul :<br/><b>STOCK/SORTIES POSSIBLES</b>">
            </aj-tooltips>
          </div>
          <div class="tooltip large last" (click)="onSortBy('calculateTimePerCase')"
            [ngClass]="{'selected': sortBy === 'calculateTimePerCase'}">
            <p>Temps moyen<br />/ dossier saisi</p>
            <div class="flex-1"></div>
            <mat-icon>{{ sortBy === 'calculateTimePerCase' ? 'filter_list' :
              'filter_list_off' }}</mat-icon>
            <aj-tooltips title="Temps moyen par dossier saisi" class="medium left"
              content="Donnée saisie dans le jeu de données choisi dans «Mes temps moyens de comparaison»">
            </aj-tooltips>
          </div>
          <div class="tooltip large last" (click)="onSortBy('calculateOut')"
            [ngClass]="{'selected': sortBy === 'calculateOut'}">
            <p>Sorties<br />possibles</p>
            <div class="flex-1"></div>
            <mat-icon>{{ sortBy === 'calculateOut' ? 'filter_list' : 'filter_list_off'
              }}</mat-icon>
            <aj-tooltips title="Sorties possibles" class="large left"
              content="Nombre moyen de dossiers pouvant être traités mensuellement par les ETPT affectés en fonction du temps moyen de traitement par dossier choisi."
              footer="Mode de calcul :<br/><b>NOMBRE DE DOSSIERS PAR ETPT x ETPT MAGISTRATS</b>">
            </aj-tooltips>
          </div>
        </div>
      </div>
    </div>
    <div class="content-list">
      <aj-referentiel-calculator *ngFor="let r of datasFilted; trackBy: trackBy" [calculator]="r" [sortBy]="sortBy">
      </aj-referentiel-calculator>
    </div>
  </div>
</aj-wrapper>

<ng-template #actions>
  <aj-select title="Contentieux" [value]="referentielIds" [datas]="formReferentiel"
    (valueChange)="updateReferentielSelected('referentiel', $event)">
  </aj-select>
  <div class="flex-1"></div>
  <aj-date-select title="Pour la période du" [value]="dateStart"
    (valueChange)="updateReferentielSelected('dateStart', $event)" class="date-start" [max]="maxDateSelectionDate">
  </aj-date-select>
  <aj-date-select title="À" [value]="dateStop" (valueChange)="updateReferentielSelected('dateStop', $event)"
    class="date-stop" [max]="maxDateSelectionDate">
  </aj-date-select>
  <aj-options-backup-panel [readOnly]="true"></aj-options-backup-panel>
</ng-template>