<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>a-just-front documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">a-just-front documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li>Interfaces</li>
  <li
  >
  HistoryInterface</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/routes/human-resource/human-resource.page.ts</code>
        </p>



            <p class="comment">
                <h3>Extends</h3>
            </p>
            <p class="comment">
                        <code><a href="../interfaces/HRSituationInterface.html" target="_self" >HRSituationInterface</a></code>
            </p>

        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#dateStop" 
>
                                            dateStop
                                        </a>
                                </li>
                                <li>
                                        <a href="#indisponibilities" 
>
                                            indisponibilities
                                        </a>
                                </li>
                                <li>
                                        <a href="#situationForTheFirstTime" 
>
                                            situationForTheFirstTime
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="dateStop"></a>
                                        <span class="name "><b>dateStop</b>
                                            <a href="#dateStop">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>dateStop:     <code>Date | null</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>Date | null</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="indisponibilities"></a>
                                        <span class="name "><b>indisponibilities</b>
                                            <a href="#indisponibilities">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>indisponibilities:     <code>RHActivityInterface[]</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>RHActivityInterface[]</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="situationForTheFirstTime"></a>
                                        <span class="name "><b>situationForTheFirstTime</b>
                                            <a href="#situationForTheFirstTime">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>situationForTheFirstTime:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnDestroy, OnInit, ViewChild } from &#x27;@angular/core&#x27;
import { ActivatedRoute, Router } from &#x27;@angular/router&#x27;
import { maxBy, minBy, orderBy, sumBy } from &#x27;lodash&#x27;
import { ActionsInterface } from &#x27;src/app/components/popup/popup.component&#x27;
import { ContentieuReferentielInterface } from &#x27;src/app/interfaces/contentieu-referentiel&#x27;
import { DocumentationInterface } from &#x27;src/app/interfaces/documentation&#x27;
import { HRCategoryInterface } from &#x27;src/app/interfaces/hr-category&#x27;
import { HRFonctionInterface } from &#x27;src/app/interfaces/hr-fonction&#x27;
import { HRSituationInterface } from &#x27;src/app/interfaces/hr-situation&#x27;
import { HumanResourceInterface } from &#x27;src/app/interfaces/human-resource-interface&#x27;
import { RHActivityInterface } from &#x27;src/app/interfaces/rh-activity&#x27;
import { MainClass } from &#x27;src/app/libs/main-class&#x27;
import { HRCategoryService } from &#x27;src/app/services/hr-category/hr-category.service&#x27;
import { HRFonctionService } from &#x27;src/app/services/hr-fonction/hr-function.service&#x27;
import { HumanResourceService } from &#x27;src/app/services/human-resource/human-resource.service&#x27;
import { copy } from &#x27;src/app/utils&#x27;
import { dateAddDays, today } from &#x27;src/app/utils/dates&#x27;
import { AddVentilationComponent } from &#x27;./add-ventilation/add-ventilation.component&#x27;

export interface HistoryInterface extends HRSituationInterface {
  indisponibilities: RHActivityInterface[]
  dateStop: Date | null
  situationForTheFirstTime: boolean
}

@Component({
  templateUrl: &#x27;./human-resource.page.html&#x27;,
  styleUrls: [&#x27;./human-resource.page.scss&#x27;],
})
export class HumanResourcePage extends MainClass implements OnInit, OnDestroy {
  @ViewChild(&#x27;addDomVentilation&#x27;)
  addDomVentilation: AddVentilationComponent | null &#x3D; null
  categories: HRCategoryInterface[] &#x3D; []
  fonctions: HRFonctionInterface[] &#x3D; []
  contentieuxReferentiel: ContentieuReferentielInterface[] &#x3D; []
  currentHR: HumanResourceInterface | null &#x3D; null
  categoryName: string &#x3D; &#x27;&#x27;
  histories: HistoryInterface[] &#x3D; []
  historiesOfThePast: HistoryInterface[] &#x3D; []
  historiesOfTheFutur: HistoryInterface[] &#x3D; []
  allIndisponibilities: RHActivityInterface[] &#x3D; []
  onEditIndex: number | null &#x3D; null // null (no edition), -1 (new edition), x (x&#x27;eme edition)
  updateIndisponiblity: RHActivityInterface | null &#x3D; null
  allIndisponibilityReferentiel: ContentieuReferentielInterface[] &#x3D; []
  indisponibilityError: string | null &#x3D; null
  actualHistoryDateStart: Date | null &#x3D; null
  actualHistoryDateStop: Date | null &#x3D; null
  indexOfTheFuture: number | null &#x3D; null
  documentation: DocumentationInterface &#x3D; {
    title: &#x27;Fiche individuelle :&#x27;,
    path: &#x27;https://a-just.gitbook.io/documentation-deploiement/ventilateur/enregistrer-une-nouvelle-situation&#x27;,
  }

  constructor(
    private humanResourceService: HumanResourceService,
    private route: ActivatedRoute,
    private router: Router,
    private hrFonctionService: HRFonctionService,
    private hrCategoryService: HRCategoryService
  ) {
    super()
  }

  ngOnInit() {
    this.watch(
      this.route.params.subscribe((params) &#x3D;&gt; {
        if (params.id) {
          this.onLoad()
        }
      })
    )
    this.watch(
      this.humanResourceService.contentieuxReferentiel.subscribe((list) &#x3D;&gt; {
        this.contentieuxReferentiel &#x3D; list
        this.allIndisponibilityReferentiel &#x3D;
          this.humanResourceService.allIndisponibilityReferentiel.slice(1)
      })
    )

    this.hrFonctionService.getAll().then((list) &#x3D;&gt; {
      this.fonctions &#x3D; list
      this.onLoad()
    })
    this.hrCategoryService.getAll().then((list) &#x3D;&gt; {
      this.categories &#x3D; list
      this.onLoad()
    })
  }

  ngOnDestroy() {
    this.watcherDestroy()
  }

  async onLoad(cacheHr: HumanResourceInterface | null &#x3D; null) {
    if (this.categories.length &#x3D;&#x3D;&#x3D; 0 || this.fonctions.length &#x3D;&#x3D;&#x3D; 0) {
      return
    }

    let findUser
    if (cacheHr) {
      findUser &#x3D; cacheHr
    } else {
      const id &#x3D; +this.route.snapshot.params.id
      findUser &#x3D; await this.humanResourceService.loadRemoteHR(id)
    }

    if (findUser) {
      this.currentHR &#x3D; findUser

      // control indisponibilities
      this.indisponibilityError &#x3D;
        this.humanResourceService.controlIndisponibilities(
          this.currentHR,
          this.currentHR.indisponibilities
        )
      console.log(findUser, { indisponibilityError: this.indisponibilityError })

      const currentSituation &#x3D; this.humanResourceService.findSituation(
        this.currentHR
      )
      if (currentSituation &amp;&amp; currentSituation.category) {
        const findCategory &#x3D; this.categories.find(
          // @ts-ignore
          (c) &#x3D;&gt; c.id &#x3D;&#x3D;&#x3D; currentSituation.category.id
        )
        this.categoryName &#x3D; findCategory ? findCategory.label.toLowerCase() : &#x27;&#x27;
      } else {
        this.categoryName &#x3D; &#x27;&#x27;
      }
    } else {
      this.currentHR &#x3D; null
      this.categoryName &#x3D; &#x27;&#x27;
    }

    this.formatHRHistory()
  }

  calculTotalTmpActivity(activities: RHActivityInterface[]) {
    activities &#x3D; this.humanResourceService.filterActivitiesByDate(
      activities || [],
      new Date()
    )

    return sumBy(
      activities.filter((ca) &#x3D;&gt; {
        return this.contentieuxReferentiel.find(
          (r) &#x3D;&gt; r.id &#x3D;&#x3D;&#x3D; ca.referentielId
        )
          ? true
          : false
      }),
      &#x27;percent&#x27;
    )
  }

  formatHRHistory() {
    if (this.fonctions.length &#x3D;&#x3D;&#x3D; 0 || !this.currentHR) {
      return
    }

    this.histories &#x3D; []
    this.historiesOfThePast &#x3D; []
    this.historiesOfTheFutur &#x3D; []

    this.allIndisponibilities &#x3D; this.currentHR.indisponibilities || []
    const situations &#x3D; orderBy(this.currentHR.situations || [], [
      function (o: HRSituationInterface) {
        const date &#x3D; new Date(o.dateStart)
        return date.getTime()
      },
    ])

    if (situations.length &#x3D;&#x3D;&#x3D; 0) {
      this.onEditIndex &#x3D; -1
      return
    }

    let listAllDates &#x3D; []
    let currentDateEnd
    if (this.currentHR.dateStart) {
      listAllDates.push(today(this.currentHR.dateStart))
    }
    if (this.currentHR.dateEnd) {
      currentDateEnd &#x3D; today(this.currentHR.dateEnd)
      listAllDates.push(currentDateEnd)
    }
    listAllDates &#x3D; listAllDates.concat(
      situations.filter((s) &#x3D;&gt; s.dateStart).map((s) &#x3D;&gt; today(s.dateStart))
    )
    listAllDates &#x3D; listAllDates.concat(
      this.allIndisponibilities
        .filter((i) &#x3D;&gt; i.dateStart)
        .map((s) &#x3D;&gt; today(s.dateStart))
    )
    listAllDates &#x3D; listAllDates.concat(
      this.allIndisponibilities
        .filter((i) &#x3D;&gt; i.dateStop)
        .map((s) &#x3D;&gt; today(s.dateStop))
    )
    console.log(listAllDates)

    const minDate &#x3D; minBy(listAllDates, (d) &#x3D;&gt; d.getTime())
    let maxDate &#x3D; maxBy(listAllDates, (d) &#x3D;&gt; d.getTime())

    if (!minDate || !maxDate) {
      this.onEditIndex &#x3D; -1
      return
    }

    // if not date end force to create a situation after the last one
    if (
      !currentDateEnd &amp;&amp;
      this.currentHR &amp;&amp;
      this.currentHR.indisponibilities &amp;&amp;
      this.currentHR.indisponibilities.length
    ) {
      maxDate &#x3D; today(maxDate) // stop reference
      maxDate.setDate(maxDate.getDate() + 1)
    }

    console.log(minDate, maxDate)

    const currentDate &#x3D; new Date(minDate)
    let idsDetected: number[] &#x3D; []
    let lastSituationId &#x3D; null

    while (currentDate.getTime() &lt;&#x3D; maxDate.getTime()) {
      let delta: number[] &#x3D; []
      const findIndispos &#x3D; this.humanResourceService.findAllIndisponibilities(
        this.currentHR,
        currentDate
      )
      const findSituation &#x3D; this.humanResourceService.findSituation(
        this.currentHR,
        currentDate
      )

      delta &#x3D; findIndispos.map((f) &#x3D;&gt; f.id)
      if (findSituation) {
        delta.push(findSituation.id)
      }

      if (JSON.stringify(idsDetected) !&#x3D;&#x3D; JSON.stringify(delta)) {
        if (
          lastSituationId &amp;&amp;
          delta.indexOf(lastSituationId) &#x3D;&#x3D;&#x3D; -1 &amp;&amp;
          this.histories.length
        ) {
          this.histories[this.histories.length - 1].situationForTheFirstTime &#x3D;
            true
        }

        lastSituationId &#x3D; (findSituation &amp;&amp; findSituation.id) || null
        idsDetected &#x3D; delta
        let etp &#x3D; (findSituation &amp;&amp; findSituation.etp) || 0

        if (
          currentDateEnd &amp;&amp;
          currentDateEnd.getTime() &lt;&#x3D; currentDate.getTime()
        ) {
          etp &#x3D; 0
        }

        const id &#x3D; (findSituation &amp;&amp; findSituation.id) || -1

        // add stop date
        if (this.histories.length) {
          this.histories[this.histories.length - 1].dateStop &#x3D; dateAddDays(
            currentDate,
            -1
          )
        }

        // new list
        this.histories.push({
          id,
          category: (findSituation &amp;&amp; findSituation.category) || null,
          fonction: (findSituation &amp;&amp; findSituation.fonction) || null,
          etp,
          indisponibilities: findIndispos,
          activities: (findSituation &amp;&amp; findSituation.activities) || [],
          dateStart: today(currentDate),
          dateStop: null,
          situationForTheFirstTime:
            (id !&#x3D;&#x3D; -1 &amp;&amp; this.histories.length &#x3D;&#x3D;&#x3D; 0) ||
            (this.histories.length &amp;&amp;
              this.histories[this.histories.length - 1].id !&#x3D;&#x3D; id)
              ? true
              : false,
        })
      }

      currentDate.setDate(currentDate.getDate() + 1)
    }

    if (
      this.histories.length &amp;&amp;
      currentDateEnd &amp;&amp;
      !this.histories[this.histories.length - 1].dateStop &amp;&amp;
      this.histories[this.histories.length - 1].dateStart.getTime() &lt;
        currentDateEnd.getTime()
    ) {
      this.histories[this.histories.length - 1].dateStop &#x3D; currentDateEnd
    }

    // add stituation if date start if lower than first situation
    if (
      this.histories.length &amp;&amp;
      this.currentHR.dateStart &amp;&amp;
      this.histories[0].dateStart.getTime() &gt;
        today(this.currentHR.dateStart).getTime()
    ) {
      const firstSituationExistant &#x3D; this.histories.find((h) &#x3D;&gt; h.category)
      this.histories.splice(0, 0, {
        id: -1,
        category: firstSituationExistant
          ? firstSituationExistant.category
          : null,
        fonction: firstSituationExistant
          ? firstSituationExistant.fonction
          : null,
        etp: 1,
        indisponibilities: [],
        activities: [],
        dateStart: today(this.currentHR.dateStart),
        dateStop: dateAddDays(this.histories[0].dateStart, -1),
        situationForTheFirstTime: false,
      })
    }

    this.histories &#x3D; this.histories.reverse() // reverse array to html render
    this.historiesOfThePast &#x3D; this.histories.filter(
      (a) &#x3D;&gt; a.dateStop &amp;&amp; a.dateStop.getTime() &lt; today().getTime()
    )
    this.historiesOfTheFutur &#x3D; this.histories.filter(
      (a) &#x3D;&gt; a.dateStart &amp;&amp; a.dateStart.getTime() &gt;&#x3D; today().getTime()
    )

    // find the actuel index of situation
    this.indexOfTheFuture &#x3D; null
    this.histories.map((h, index) &#x3D;&gt; {
      const dateStart &#x3D; h.dateStart ? h.dateStart : null
      const dateStop &#x3D; h.dateStop ? h.dateStop : null

      if (
        ((dateStart &amp;&amp; dateStart.getTime() &lt;&#x3D; today().getTime()) ||
          !dateStart) &amp;&amp;
        ((dateStop &amp;&amp; dateStop.getTime() &gt;&#x3D; today().getTime()) || !dateStop)
      ) {
        this.indexOfTheFuture &#x3D; index
      }
    })

    this.actualHistoryDateStart &#x3D; null
    this.actualHistoryDateStop &#x3D; null
    if (this.indexOfTheFuture &#x3D;&#x3D;&#x3D; null) {
      // check if past or the future
      if (this.histories.length) {
        if (
          this.histories[this.histories.length - 1].dateStart.getTime() &gt;
          today().getTime()
        ) {
          this.actualHistoryDateStop &#x3D;
            this.histories[this.histories.length - 1].dateStart
        } else if (
          this.histories[0].dateStop &amp;&amp;
          this.histories[0].dateStop.getTime() &lt; today().getTime()
        ) {
          const dateStop &#x3D; new Date(this.histories[0].dateStop)
          dateStop.setDate(dateStop.getDate() + 1)
          this.actualHistoryDateStart &#x3D; dateStop
        }
      }
    } else {
      this.actualHistoryDateStart &#x3D;
        this.histories[this.indexOfTheFuture].dateStart
      this.actualHistoryDateStop &#x3D;
        this.histories[this.indexOfTheFuture].dateStop
    }

    console.log({
      indexOfTheFuture: this.indexOfTheFuture,
      histories: this.histories,
      actualHistoryDateStart: this.actualHistoryDateStart,
      actualHistoryDateStop: this.actualHistoryDateStop,
    })
  }

  trackByDate(index: number, item: any) {
    return item.dateStart
  }

  async onDelete() {
    if (this.currentHR) {
      if (await this.humanResourceService.removeHrById(this.currentHR.id)) {
        this.router.navigate([&#x27;/ventilations&#x27;])
      }
    }
  }

  async updateHuman(nodeName: string, value: any, directRef?: any) {
    if (this.currentHR) {
      if (
        nodeName &#x3D;&#x3D;&#x3D; &#x27;firstName&#x27; ||
        nodeName &#x3D;&#x3D;&#x3D; &#x27;lastName&#x27; ||
        nodeName &#x3D;&#x3D;&#x3D; &#x27;matricule&#x27;
      ) {
        directRef.srcElement.innerText &#x3D; value.innerText
        value &#x3D; value.innerText
        console.log(value)
      } else if (value &amp;&amp; typeof value.innerText !&#x3D;&#x3D; &#x27;undefined&#x27;) {
        value &#x3D; value.innerText
      }
      console.log({
        [nodeName]: value,
      })
      this.onLoad(
        await this.humanResourceService.updatePersonById(this.currentHR, {
          [nodeName]: value,
        })
      )
    }
  }

  async onCancel(removeIndispo: boolean &#x3D; false) {
    if (
      removeIndispo &amp;&amp;
      this.currentHR &amp;&amp;
      this.currentHR.indisponibilities.length
    ) {
      await this.updateHuman(&#x27;indisponibilities&#x27;, [])
    }

    this.onEditIndex &#x3D; null

    const findElement &#x3D; document.getElementById(&#x27;content&#x27;)
    if (findElement) {
      findElement.scrollTo({
        behavior: &#x27;smooth&#x27;,
        top: 0,
      })
    }
  }

  onSave() {
    if (this.addDomVentilation) {
      this.addDomVentilation.onSave()
    }
  }

  onNewUpdate() {
    this.onEditIndex &#x3D; null
    this.onLoad()
  }

  onAddIndispiniblity(indispo: RHActivityInterface | null &#x3D; null) {
    this.updateIndisponiblity &#x3D; indispo
      ? copy(indispo)
      : {
          id: this.allIndisponibilities.length * -1 - 1,
          percent: 0,
          contentieux: {
            ...this.allIndisponibilityReferentiel[0],
          },
          dateStart: null,
        }
  }

  async onEditIndisponibility(action: ActionsInterface) {
    const controlIndisponibilitiesError &#x3D; this.onEditIndex &#x3D;&#x3D;&#x3D; null // if panel ediction do not control error

    switch (action.id) {
      case &#x27;close&#x27;:
        {
          this.updateIndisponiblity &#x3D; null
        }
        break
      case &#x27;modify&#x27;:
        {
          if (
            this.updateIndisponiblity &amp;&amp;
            !this.updateIndisponiblity.dateStart
          ) {
            alert(&quot;Vous devez saisir une date de début d&#x27;indisponibilité !&quot;)
            return false
          }

          if (this.updateIndisponiblity &amp;&amp; !this.updateIndisponiblity.percent) {
            alert(&quot;Vous devez saisir un temps d&#x27;indisponibilité !&quot;)
            return false
          }

          if (
            this.updateIndisponiblity &amp;&amp;
            this.updateIndisponiblity.percent &amp;&amp;
            this.updateIndisponiblity.percent &gt; 100
          ) {
            alert(&quot;Vous ne pouvez pas saisir plus de 100% d&#x27;indisponibilité !&quot;)
            return false
          }

          if (
            this.updateIndisponiblity &amp;&amp;
            !this.updateIndisponiblity.dateStart
          ) {
            alert(&quot;Vous devez saisir une date de départ d&#x27;indisponibilité !&quot;)
            return false
          }

          if (
            this.updateIndisponiblity &amp;&amp;
            !this.allIndisponibilityReferentiel.find(
              (i) &#x3D;&gt; i.id &#x3D;&#x3D; this.updateIndisponiblity?.contentieux.id
            )
          ) {
            alert(&quot;Vous devez saisir un type d&#x27;indisponibilité !&quot;)
            return false
          }

          // control date start
          if (this.currentHR &amp;&amp; this.currentHR.dateStart) {
            const hrDateStart &#x3D; new Date(this.currentHR.dateStart)

            if (
              this.updateIndisponiblity &amp;&amp;
              this.updateIndisponiblity.dateStart
            ) {
              const indispDateStart &#x3D; new Date(
                this.updateIndisponiblity.dateStart
              )
              if (hrDateStart.getTime() &gt; indispDateStart.getTime()) {
                alert(
                  &quot;Vous ne pouvez pas saisir une date de début d&#x27;indisponibilité antérieure à la date d&#x27;arrivée !&quot;
                )
                return false
              }
            }

            if (
              this.updateIndisponiblity &amp;&amp;
              this.updateIndisponiblity.dateStop
            ) {
              const indispDateStop &#x3D; new Date(
                this.updateIndisponiblity.dateStop
              )
              if (hrDateStart.getTime() &gt; indispDateStop.getTime()) {
                alert(
                  &quot;Vous ne pouvez pas saisir une date de fin d&#x27;indisponibilités antérieure à la date d&#x27;arrivée !&quot;
                )
                return false
              }
            }
          }

          // control date stop
          if (this.currentHR &amp;&amp; this.currentHR.dateEnd) {
            const hrDateStop &#x3D; new Date(this.currentHR.dateEnd)

            if (
              this.updateIndisponiblity &amp;&amp;
              this.updateIndisponiblity.dateStart
            ) {
              const indispDateStart &#x3D; new Date(
                this.updateIndisponiblity.dateStart
              )
              if (hrDateStop.getTime() &lt; indispDateStart.getTime()) {
                alert(
                  &quot;Vous ne pouvez pas saisir une date de début d&#x27;indisponibilité postérieure à la date de départ !&quot;
                )
                return false
              }
            }

            if (
              this.updateIndisponiblity &amp;&amp;
              this.updateIndisponiblity.dateStop
            ) {
              const indispDateStop &#x3D; new Date(
                this.updateIndisponiblity.dateStop
              )
              if (hrDateStop.getTime() &lt; indispDateStop.getTime()) {
                alert(
                  &quot;Vous ne pouvez pas saisir une date de fin d&#x27;indisponibilité postérieure à la date de départ !&quot;
                )
                return false
              }
            }
          }

          // control date start and date stop
          if (
            this.updateIndisponiblity &amp;&amp;
            this.updateIndisponiblity.dateStart &amp;&amp;
            this.updateIndisponiblity.dateStop
          ) {
            const indispDateStart &#x3D; new Date(
              this.updateIndisponiblity.dateStart
            )
            const indispDateStop &#x3D; new Date(this.updateIndisponiblity.dateStop)
            if (indispDateStart.getTime() &gt; indispDateStop.getTime()) {
              alert(
                &#x27;Vous ne pouvez pas saisir une date de début postérieure à la date de fin !&#x27;
              )
              return false
            }
          }

          if (this.updateIndisponiblity) {
            // force id to int with selector
            this.updateIndisponiblity.contentieux.id &#x3D;
              +this.updateIndisponiblity.contentieux.id

            const index &#x3D; this.allIndisponibilities.findIndex(
              (i) &#x3D;&gt; i.id &#x3D;&#x3D;&#x3D; this.updateIndisponiblity?.id
            )
            const contentieux &#x3D; this.allIndisponibilityReferentiel.find(
              (c) &#x3D;&gt; c.id &#x3D;&#x3D;&#x3D; this.updateIndisponiblity?.contentieux.id
            )

            if (!contentieux) {
              alert(&quot;Il y a un problème avec l&#x27;indisponibilitiés choisie.&quot;)
              return false
            }

            if (index !&#x3D;&#x3D; -1) {
              this.allIndisponibilities[index] &#x3D; {
                ...this.allIndisponibilities[index],
                ...this.updateIndisponiblity,
                contentieux,
              }
            } else if (this.updateIndisponiblity) {
              this.allIndisponibilities.push({
                ...this.updateIndisponiblity,
                contentieux,
              })
            }
            if (this.currentHR) {
              this.indisponibilityError &#x3D;
                this.humanResourceService.controlIndisponibilities(
                  this.currentHR,
                  this.allIndisponibilities
                )
              if (controlIndisponibilitiesError &amp;&amp; this.indisponibilityError) {
                alert(this.indisponibilityError)
                this.onAddIndispiniblity(this.updateIndisponiblity)
                return false
              } else {
                this.updateIndisponiblity &#x3D; null
              }

              if (!this.indisponibilityError) {
                await this.updateHuman(
                  &#x27;indisponibilities&#x27;,
                  this.allIndisponibilities
                )
              }
            } else {
              this.updateIndisponiblity &#x3D; null
            }
          }
        }
        break
      case &#x27;delete&#x27;:
        {
          const index &#x3D; this.allIndisponibilities.findIndex(
            (i) &#x3D;&gt;
              i.id &#x3D;&#x3D;&#x3D;
              ((this.updateIndisponiblity &amp;&amp; this.updateIndisponiblity.id) ||
                &#x27;&#x27;)
          )
          if (index !&#x3D;&#x3D; -1) {
            this.allIndisponibilities.splice(index, 1)
            if (this.currentHR) {
              this.indisponibilityError &#x3D;
                this.humanResourceService.controlIndisponibilities(
                  this.currentHR,
                  this.allIndisponibilities
                )

              if (!this.indisponibilityError) {
                await this.updateHuman(
                  &#x27;indisponibilities&#x27;,
                  this.allIndisponibilities
                )
              }
            }
          }
          this.updateIndisponiblity &#x3D; null
        }
        break
    }

    return true
  }

  onSelectSituationToEdit(history: HistoryInterface | null &#x3D; null) {
    const index &#x3D; history
      ? this.histories.findIndex(
          (h) &#x3D;&gt; h.id &#x3D;&#x3D;&#x3D; history.id &amp;&amp; h.dateStart &#x3D;&#x3D;&#x3D; history.dateStart
        )
      : -1

    if (this.onEditIndex &#x3D;&#x3D;&#x3D; null) {
      if (index &#x3D;&#x3D;&#x3D; -1) {
        // add situation
        this.onEditIndex &#x3D; -1
      } else {
        // edit situation
        this.onEditIndex &#x3D; index
      }

      setTimeout(() &#x3D;&gt; {
        const findContent &#x3D; document.getElementById(&#x27;content&#x27;)
        if (findContent) {
          const findElements &#x3D;
            findContent.getElementsByTagName(&#x27;add-ventilation&#x27;)
          if (findElements &amp;&amp; findElements.length) {
            findContent.scrollTo({
              behavior: &#x27;smooth&#x27;,
              top:
                findElements[0].getBoundingClientRect().top -
                87 +
                findContent.scrollTop,
            })
          }
        }
      }, 100)
    } else {
      alert(&#x27;Vous ne pouvez pas modifier plusieurs situations en même temps !&#x27;)
    }

    if (this.currentHR) {
      // force to control indisponibilities
      this.indisponibilityError &#x3D;
        this.humanResourceService.controlIndisponibilities(
          this.currentHR,
          this.currentHR.indisponibilities
        )
      console.log({ indisponibilityError: this.indisponibilityError })
    }
  }

  async onRemoveSituation(id: number) {
    const returnValue &#x3D; await this.humanResourceService.removeSituation(id)
    console.log(returnValue, this.histories.length, this.onEditIndex)
    if (returnValue) {
      // force to not show on boarding after delete last situation
      this.onEditIndex &#x3D; null
      this.onLoad(returnValue)
    }
  }
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'HistoryInterface.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
