<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>a-just-front documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">a-just-front documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  HistoryInterface</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/routes/human-resource/human-resource.page.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Interface d&#39;une situation</p>

            </p>

            <p class="comment">
                <h3>Extends</h3>
            </p>
            <p class="comment">
                            <code><a href="../interfaces/HRSituationInterface.html" target="_self" >HRSituationInterface</a></code>
            </p>

        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#dateStop" 
>
                                            dateStop
                                        </a>
                                </li>
                                <li>
                                        <a href="#indisponibilities" 
>
                                            indisponibilities
                                        </a>
                                </li>
                                <li>
                                        <a href="#situationForTheFirstTime" 
>
                                            situationForTheFirstTime
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="dateStop"></a>
                                        <span class="name "><b>dateStop</b>
                                            <a href="#dateStop">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>dateStop:     <code>Date | null</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>Date | null</code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Date de fin</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="indisponibilities"></a>
                                        <span class="name "><b>indisponibilities</b>
                                            <a href="#indisponibilities">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>indisponibilities:     <code>RHActivityInterface[]</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>RHActivityInterface[]</code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Liste des indisponibilités</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="situationForTheFirstTime"></a>
                                        <span class="name "><b>situationForTheFirstTime</b>
                                            <a href="#situationForTheFirstTime">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>situationForTheFirstTime:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Première situation</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnDestroy, OnInit, signal, ViewChild, ElementRef, Signal, WritableSignal } from &#x27;@angular/core&#x27;
import { FormControl, FormGroup, FormsModule } from &#x27;@angular/forms&#x27;
import { ActivatedRoute, Router } from &#x27;@angular/router&#x27;
import _, { maxBy, minBy, orderBy } from &#x27;lodash&#x27;
import { debounceTime } from &#x27;rxjs&#x27;
import { AddVentilationComponent } from &#x27;./add-ventilation/add-ventilation.component&#x27;
import { HRSituationInterface } from &#x27;../../interfaces/hr-situation&#x27;
import { RHActivityInterface } from &#x27;../../interfaces/rh-activity&#x27;
import { WrapperComponent } from &#x27;../../components/wrapper/wrapper.component&#x27;
import { CoverProfilDetailsComponent } from &#x27;./cover-profil-details/cover-profil-details.component&#x27;
import { IndispoProfilComponent } from &#x27;./indispo-profil/indispo-profil.component&#x27;
import { ActualPanelSituationComponent } from &#x27;./actual-panel-situation/actual-panel-situation.component&#x27;
import { CommentProfilComponent } from &#x27;./comment-profil/comment-profil.component&#x27;
import { PanelHistoryVentilationComponent } from &#x27;./panel-history-ventilation/panel-history-ventilation.component&#x27;
import { ActionsInterface, PopupComponent } from &#x27;../../components/popup/popup.component&#x27;
import { DateSelectComponent } from &#x27;../../components/date-select/date-select.component&#x27;
import { MainClass } from &#x27;../../libs/main-class&#x27;
import { HRCategoryInterface } from &#x27;../../interfaces/hr-category&#x27;
import { HRFonctionInterface } from &#x27;../../interfaces/hr-fonction&#x27;
import { ContentieuReferentielInterface } from &#x27;../../interfaces/contentieu-referentiel&#x27;
import { HumanResourceInterface } from &#x27;../../interfaces/human-resource-interface&#x27;
import { HumanResourceService } from &#x27;../../services/human-resource/human-resource.service&#x27;
import { HRFonctionService } from &#x27;../../services/hr-fonction/hr-function.service&#x27;
import { HRCategoryService } from &#x27;../../services/hr-category/hr-category.service&#x27;
import { AppService } from &#x27;../../services/app/app.service&#x27;
import { HRCommentService } from &#x27;../../services/hr-comment/hr-comment.service&#x27;
import { UserService } from &#x27;../../services/user/user.service&#x27;
import { dateAddDays, getTime, isDateBiggerThan, setTimeToMidDay, today } from &#x27;../../utils/dates&#x27;
import { copy } from &#x27;../../utils&#x27;
import { HelpButtonComponent } from &#x27;../../components/help-button/help-button.component&#x27;
import { CommonModule } from &#x27;@angular/common&#x27;
import { MatSelectModule } from &#x27;@angular/material/select&#x27;
import { MatFormFieldModule } from &#x27;@angular/material/form-field&#x27;
import { MatInputModule } from &#x27;@angular/material/input&#x27;

/**
 * Interface d&#x27;une situation
 */
export interface HistoryInterface extends HRSituationInterface {
  /**
   * Liste des indisponibilités
   */
  indisponibilities: RHActivityInterface[]
  /**
   * Date de fin
   */
  dateStop: Date | null
  /**
   * Première situation
   */
  situationForTheFirstTime: boolean
}

/**
 * Page qui affiche en détail une fiche
 */

@Component({
  standalone: true,
  imports: [
    WrapperComponent,
    CoverProfilDetailsComponent,
    IndispoProfilComponent,
    ActualPanelSituationComponent,
    CommentProfilComponent,
    AddVentilationComponent,
    PanelHistoryVentilationComponent,
    PopupComponent,
    DateSelectComponent,
    HelpButtonComponent,
    CommonModule,
    FormsModule,
    MatFormFieldModule,
    MatSelectModule,
    MatInputModule,
  ],
  templateUrl: &#x27;./human-resource.page.html&#x27;,
  styleUrls: [&#x27;./human-resource.page.scss&#x27;],
})
export class HumanResourcePage extends MainClass implements OnInit, OnDestroy {
  /**
   * Dom du wrapper
   */
  @ViewChild(&#x27;wrapper&#x27;) wrapper: WrapperComponent | undefined
  /**
   * Dom du paneau d&#x27;ajout d&#x27;une situation
   */
  @ViewChild(&#x27;addDomVentilation&#x27;)
  addDomVentilation: AddVentilationComponent | null &#x3D; null

  /**
   *
   */
  @ViewChild(CoverProfilDetailsComponent)
  coverDetails!: CoverProfilDetailsComponent

  /**
   * Liste des catégories existantes
   */
  categories: HRCategoryInterface[] &#x3D; []
  /**
   * Liste des fonctions existantes
   */
  fonctions: HRFonctionInterface[] &#x3D; []
  /**
   * Référentiel
   */
  contentieuxReferentiel: ContentieuReferentielInterface[] &#x3D; []
  /**
   * Fiche
   */
  currentHR: HumanResourceInterface | null &#x3D; null
  /**
   * Retour sur la catégorie
   */
  categoryName: string &#x3D; &#x27;&#x27;
  /**
   * Liste de toutes les situations
   */
  histories: HistoryInterface[] &#x3D; []
  /**
   * Situations passé à aujourd&#x27;hui
   */
  historiesOfThePast: HistoryInterface[] &#x3D; []
  /**
   * Situations futur à aujourd&#x27;hui
   */
  historiesOfTheFutur: HistoryInterface[] &#x3D; []
  /**
   * Liste de toutes les indispo de la fiche
   */
  allIndisponibilities: RHActivityInterface[] &#x3D; []
  /**
   * Mode d&#x27;édition courant
   */
  onEditIndex: number | null &#x3D; null // null (no edition), -1 (new edition), x (x&#x27;eme edition)
  /**
   * Indispo en court d&#x27;édition
   */
  updateIndisponiblity: RHActivityInterface | null &#x3D; null
  /**
   * Référentiel des indispo
   */
  allIndisponibilityReferentiel: ContentieuReferentielInterface[] &#x3D; []
  /**
   * Référentiel des indispo groupedByCategory
   */
  groupedIndispo: any[] &#x3D; []
  /**
   * Indispos en error (chevauchement de date ou plus de 100%)
   */
  indisponibilityError: string | null &#x3D; null
  /**
   * Première date de situation
   */
  actualHistoryDateStart: Date | null &#x3D; null
  /**
   * Derniere date de situation
   */
  actualHistoryDateStop: Date | null &#x3D; null
  /**
   * Index de la situation en cour d&#x27;édition
   */
  indexOfTheFuture: number | null &#x3D; null
  /**
   * Variable en cours d&#x27;export de page
   */
  duringPrint: boolean &#x3D; false
  /**
   * Get Link to back
   */
  routerLinkToGoBack: string[] &#x3D; [&#x27;/&#x27;]
  /**
   * Formulaire de saisie
   */
  basicHrInfo &#x3D; new FormGroup({
    lastName: new FormControl(&#x27;&#x27;),
    firstName: new FormControl(&#x27;&#x27;),
    matricule: new FormControl(&#x27;&#x27;),
  })
  /**
   * showActuelPanel
   */
  showActuelPanel: boolean &#x3D; false
  /**
   * Initial etp
   */
  initialETP: number | null &#x3D; null
  /**
   * Current etp
   */
  currentETP: number | null &#x3D; null
  /**
   * Liste des alertes à afficher
   */
  alertList: WritableSignal&lt;string[]&gt; &#x3D; signal([])

  hasInitCalendars &#x3D; false
  hasInitInputs &#x3D; false
  calendarsOpened: number[] &#x3D; []

  /**
   * Constructeur
   * @param humanResourceService
   * @param route
   * @param router
   * @param hrFonctionService
   * @param hrCategoryService
   */
  constructor(
    private humanResourceService: HumanResourceService,
    private route: ActivatedRoute,
    private router: Router,
    private hrFonctionService: HRFonctionService,
    private hrCategoryService: HRCategoryService,
    public appService: AppService,
    private hrCommentService: HRCommentService,
    private userService: UserService,
  ) {
    super()

    this.basicHrInfo.valueChanges.pipe(debounceTime(500)).subscribe((v) &#x3D;&gt; {
      if (this.currentHR &amp;&amp; this.onEditIndex &#x3D;&#x3D;&#x3D; null) {
        let options &#x3D; {}

        if (v.firstName !&#x3D;&#x3D; (this.currentHR.firstName || &#x27;&#x27;)) {
          options &#x3D; { ...options, firstName: v.firstName }
        }
        if (v.lastName !&#x3D;&#x3D; (this.currentHR.lastName || &#x27;&#x27;)) {
          options &#x3D; { ...options, lastName: v.lastName }
        }
        if (v.matricule !&#x3D;&#x3D; (this.currentHR.matricule || &#x27;&#x27;)) {
          options &#x3D; { ...options, matricule: v.matricule }
        }

        if (Object.keys(options).length) {
          // @ts-ignore
          if (options.lastName &#x3D;&#x3D;&#x3D; &#x27;&#x27; || options.lastName &#x3D;&#x3D;&#x3D; &#x27;Nom&#x27;) {
            setTimeout(() &#x3D;&gt; {
              alert(&#x27;Vous devez saisir un nom pour valider la création !&#x27;)
            }, 1500)
            return
          }
          // @ts-ignore
          if (options.firstName &#x3D;&#x3D;&#x3D; &#x27;&#x27; || options.firstName &#x3D;&#x3D;&#x3D; &#x27;Prénom&#x27;) {
            setTimeout(() &#x3D;&gt; {
              alert(&#x27;Vous devez saisir un prénom pour valider la création !&#x27;)
            }, 1500)
            return
          }

          this.humanResourceService.updatePersonById(this.currentHR, options)
          this.currentHR &#x3D; {
            ...this.currentHR,
            ...options,
          }
        }
      }
    })
  }

  /**
   * Au chargement récupération des variables globales + chargement
   */
  ngOnInit() {
    this.watch(
      this.route.params.subscribe((params) &#x3D;&gt; {
        if (params[&#x27;id&#x27;]) {
          this.onLoad()
        }
      }),
    )
    this.watch(
      this.humanResourceService.contentieuxReferentiel.subscribe((list) &#x3D;&gt; {
        this.contentieuxReferentiel &#x3D; list
        this.allIndisponibilityReferentiel &#x3D; this.humanResourceService.allIndisponibilityReferentiel.slice(1)
        this.groupedIndispo &#x3D; this.groupIndispoByCategory()
      }),
    )

    this.hrFonctionService.getAll().then((list) &#x3D;&gt; {
      this.fonctions &#x3D; list
      this.onLoad()
    })
    this.hrCategoryService.getAll().then((list) &#x3D;&gt; {
      this.categories &#x3D; list
      this.onLoad()
    })
  }

  ngAfterViewInit() {
    this.routerLinkToGoBack &#x3D; this.appService.previousUrl ? [this.appService.previousUrl] : [&#x27;/&#x27;]
  }

  ngAfterViewChecked() {
    if (!this.hasInitCalendars &amp;&amp; !this.hasInitInputs &amp;&amp; this.coverDetails) {
      this.hasInitCalendars &#x3D; true
      this.hasInitInputs &#x3D; true
    }
  }

  /**
   * A la destruction suppression des observables
   */
  ngOnDestroy() {
    this.watcherDestroy()
  }

  /**
   * Chargement de la fiche coté back + traitement
   * @param cacheHr
   * @returns
   */
  async onLoad(cacheHr: HumanResourceInterface | null &#x3D; null, updated &#x3D; true) {
    if (this.categories.length &#x3D;&#x3D;&#x3D; 0 || this.fonctions.length &#x3D;&#x3D;&#x3D; 0) {
      return
    }

    let findUser &#x3D; null
    if (cacheHr) {
      findUser &#x3D; cacheHr
    } else {
      const id &#x3D; +this.route.snapshot.params[&#x27;id&#x27;]
      findUser &#x3D; await this.humanResourceService.loadRemoteHR(id)
    }
    console.log(&#x27;userFinded&#x27;, findUser)
    if (findUser) {
      this.currentHR &#x3D; findUser

      if (updated) {
        this.basicHrInfo.get(&#x27;firstName&#x27;)?.setValue(findUser.firstName || &#x27;&#x27;)
        this.basicHrInfo.get(&#x27;lastName&#x27;)?.setValue(findUser.lastName || &#x27;&#x27;)
        this.basicHrInfo.get(&#x27;matricule&#x27;)?.setValue(findUser.matricule || &#x27;&#x27;)
        this.humanResourceService.alertList.set([])
      }

      // control indisponibilities
      this.indisponibilityError &#x3D; this.humanResourceService.controlIndisponibilities(this.currentHR, this.currentHR?.indisponibilities || [])
      // console.log(findUser, { indisponibilityError: this.indisponibilityError })

      const currentSituation &#x3D; this.humanResourceService.findSituation(this.currentHR)
      if (currentSituation &amp;&amp; currentSituation.category) {
        const findCategory &#x3D; this.categories.find(
          // @ts-ignore
          (c) &#x3D;&gt; c.id &#x3D;&#x3D;&#x3D; currentSituation.category.id,
        )
        this.categoryName &#x3D; findCategory ? findCategory.label.toLowerCase() : &#x27;&#x27;
      } else {
        this.categoryName &#x3D; &#x27;&#x27;
      }
    } else {
      this.currentHR &#x3D; null
      this.categoryName &#x3D; &#x27;&#x27;
    }

    console.log(&#x27;this.currentHR&#x27;, this.currentHR)

    this.formatHRHistory()
  }

  /**
   * Génération des situations artificielle ou non
   */

  formatHRHistory() {
    this.allIndisponibilities &#x3D; this.currentHR?.indisponibilities || []

    if (this.fonctions.length &#x3D;&#x3D;&#x3D; 0 || !this.currentHR || this.onEditIndex !&#x3D;&#x3D; null) {
      return
    }

    // if no situation and createdAt is more than 6 hours ago
    if (this.currentHR.situations.length &#x3D;&#x3D;&#x3D; 0 &amp;&amp; this.currentHR.createdAt &amp;&amp; getTime() - getTime(this.currentHR.createdAt) &gt; 60 * 1000) {
      this.onEditIndex &#x3D; null
      return
    }

    this.histories &#x3D; []
    this.historiesOfThePast &#x3D; []
    this.historiesOfTheFutur &#x3D; []

    const situations &#x3D; orderBy(this.currentHR.situations || [], [
      function (o: HRSituationInterface) {
        const date &#x3D; new Date(o.dateStart)
        return date.getTime()
      },
    ])

    if (situations.length &#x3D;&#x3D;&#x3D; 0) {
      this.onEditIndex &#x3D; -1
      return
    }

    let listAllDates &#x3D; []
    let currentDateEnd
    if (this.currentHR.dateStart) {
      listAllDates.push(today(this.currentHR.dateStart))
    }
    if (this.currentHR.dateEnd) {
      currentDateEnd &#x3D; today(this.currentHR.dateEnd)
      listAllDates.push(currentDateEnd)
    }
    listAllDates &#x3D; listAllDates.concat(situations.filter((s) &#x3D;&gt; s.dateStart).map((s) &#x3D;&gt; today(s.dateStart)))
    listAllDates &#x3D; listAllDates.concat(this.allIndisponibilities.filter((i) &#x3D;&gt; i.dateStart).map((s) &#x3D;&gt; today(s.dateStart)))
    listAllDates &#x3D; listAllDates.concat(this.allIndisponibilities.filter((i) &#x3D;&gt; i.dateStop).map((s) &#x3D;&gt; today(s.dateStop)))
    // console.log(listAllDates)

    const minDate &#x3D; minBy(listAllDates, (d) &#x3D;&gt; d.getTime())
    let maxDate &#x3D; maxBy(listAllDates, (d) &#x3D;&gt; d.getTime())

    if (!minDate || !maxDate) {
      this.onEditIndex &#x3D; -1
      return
    }

    // if not date end force to create a situation after the last one
    if (!currentDateEnd &amp;&amp; this.currentHR &amp;&amp; this.currentHR.indisponibilities &amp;&amp; this.currentHR.indisponibilities.length) {
      maxDate &#x3D; today(maxDate) // stop reference
      maxDate.setDate(maxDate.getDate() + 1)
    }

    // console.log(minDate, maxDate)

    const currentDate &#x3D; new Date(minDate)
    let idsDetected: number[] &#x3D; []
    let lastSituationId &#x3D; null

    while (currentDate.getTime() &lt;&#x3D; maxDate.getTime()) {
      let delta: number[] &#x3D; []
      const findIndispos &#x3D; this.humanResourceService.findAllIndisponibilities(this.currentHR, currentDate)
      const findSituation &#x3D; this.humanResourceService.findSituation(this.currentHR, currentDate)

      delta &#x3D; findIndispos.map((f) &#x3D;&gt; f.id)
      if (findSituation) {
        delta.push(findSituation.id)
      }

      if (JSON.stringify(idsDetected) !&#x3D;&#x3D; JSON.stringify(delta)) {
        if (lastSituationId &amp;&amp; delta.indexOf(lastSituationId) &#x3D;&#x3D;&#x3D; -1 &amp;&amp; this.histories.length) {
          this.histories[this.histories.length - 1].situationForTheFirstTime &#x3D; true
        }

        lastSituationId &#x3D; (findSituation &amp;&amp; findSituation.id) || null
        idsDetected &#x3D; delta
        let etp &#x3D; findSituation !&#x3D;&#x3D; null ? findSituation.etp : null
        if (findIndispos.length !&#x3D;&#x3D; 0 &amp;&amp; etp &#x3D;&#x3D;&#x3D; null) {
          etp &#x3D; null
        }

        if (currentDateEnd &amp;&amp; currentDateEnd.getTime() &lt;&#x3D; currentDate.getTime()) {
          etp &#x3D; 0
        }

        let id &#x3D; (findSituation &amp;&amp; findSituation.id) || -1
        if (this.histories.find((h) &#x3D;&gt; h.id &#x3D;&#x3D;&#x3D; id)) {
          id &#x3D; -1
        }

        // add stop date
        if (this.histories.length) {
          this.histories[this.histories.length - 1].dateStop &#x3D; dateAddDays(currentDate, -1)
        }

        // new list
        this.histories.push({
          id,
          category: (findSituation &amp;&amp; findSituation.category) || null,
          fonction: (findSituation &amp;&amp; findSituation.fonction) || null,
          etp,
          indisponibilities: findIndispos,
          activities: (findSituation &amp;&amp; findSituation.activities) || [],
          dateStart: today(currentDate),
          dateStop: null,
          situationForTheFirstTime:
            (id !&#x3D;&#x3D; -1 &amp;&amp; this.histories.length &#x3D;&#x3D;&#x3D; 0) || (this.histories.length &amp;&amp; this.histories[this.histories.length - 1].id !&#x3D;&#x3D; id) ? true : false,
        })
      }

      currentDate.setDate(currentDate.getDate() + 1)
    }

    if (
      this.histories.length &amp;&amp;
      currentDateEnd &amp;&amp;
      !this.histories[this.histories.length - 1].dateStop &amp;&amp;
      this.histories[this.histories.length - 1].dateStart.getTime() &lt; currentDateEnd.getTime()
    ) {
      this.histories[this.histories.length - 1].dateStop &#x3D; currentDateEnd
    }

    // add stituation if date start if lower than first situation
    if (this.histories.length &amp;&amp; this.currentHR.dateStart &amp;&amp; this.histories[0].dateStart.getTime() &gt; today(this.currentHR.dateStart).getTime()) {
      const firstSituationExistant &#x3D; this.histories.find((h) &#x3D;&gt; h.category)
      this.histories.splice(0, 0, {
        id: -1,
        category: firstSituationExistant ? firstSituationExistant.category : null,
        fonction: firstSituationExistant ? firstSituationExistant.fonction : null,
        etp: null,
        indisponibilities: [],
        activities: [],
        dateStart: today(this.currentHR.dateStart),
        dateStop: dateAddDays(this.histories[0].dateStart, -1),
        situationForTheFirstTime: false,
      })
    }

    this.histories &#x3D; this.histories.reverse() // reverse array to html render
    this.historiesOfThePast &#x3D; this.histories.filter((a) &#x3D;&gt; a.dateStop &amp;&amp; a.dateStop.getTime() &lt; today().getTime())
    this.historiesOfTheFutur &#x3D; this.histories.filter((a) &#x3D;&gt; a.dateStart &amp;&amp; a.dateStart.getTime() &gt; today().getTime())

    // find the actuel index of situation
    this.indexOfTheFuture &#x3D; null
    this.histories.map((h, index) &#x3D;&gt; {
      const dateStart &#x3D; h.dateStart ? h.dateStart : null
      const dateStop &#x3D; h.dateStop ? h.dateStop : null

      if (((dateStart &amp;&amp; dateStart.getTime() &lt;&#x3D; today().getTime()) || !dateStart) &amp;&amp; ((dateStop &amp;&amp; dateStop.getTime() &gt;&#x3D; today().getTime()) || !dateStop)) {
        this.indexOfTheFuture &#x3D; index
        this.currentETP &#x3D; this.histories[index].etp
        this.initialETP &#x3D; this.currentETP
      }
    })

    this.actualHistoryDateStart &#x3D; null
    this.actualHistoryDateStop &#x3D; null
    if (this.indexOfTheFuture &#x3D;&#x3D;&#x3D; null) {
      // check if past or the future
      if (this.histories.length) {
        if (this.histories[this.histories.length - 1].dateStart.getTime() &gt; today().getTime()) {
          this.actualHistoryDateStop &#x3D; this.histories[this.histories.length - 1].dateStart
        } else if (this.histories[0].dateStop &amp;&amp; this.histories[0].dateStop.getTime() &lt; today().getTime()) {
          const dateStop &#x3D; new Date(this.histories[0].dateStop)
          dateStop.setDate(dateStop.getDate() + 1)
          this.actualHistoryDateStart &#x3D; dateStop
        }
      }
    } else {
      this.actualHistoryDateStart &#x3D; this.histories[this.indexOfTheFuture].dateStart
      this.actualHistoryDateStop &#x3D; this.histories[this.indexOfTheFuture].dateStop
    }

    /* console.log({
      indexOfTheFuture: this.indexOfTheFuture,
      histories: this.histories,
      actualHistoryDateStart: this.actualHistoryDateStart,
      actualHistoryDateStop: this.actualHistoryDateStop,
    }) */

    if (this.actualHistoryDateStart &amp;&amp; this.currentHR.dateEnd &amp;&amp; isDateBiggerThan(this.actualHistoryDateStart, this.currentHR.dateEnd)) {
      this.showActuelPanel &#x3D; false
    } else if (
      !this.actualHistoryDateStart &amp;&amp;
      this.actualHistoryDateStop &amp;&amp;
      this.currentHR.dateStart &amp;&amp;
      isDateBiggerThan(this.currentHR.dateStart, this.actualHistoryDateStop)
    ) {
      this.showActuelPanel &#x3D; false
    } else {
      this.showActuelPanel &#x3D; true
    }

    console.log(&#x27;this.showActuelPanel&#x27;, this.histories)

    this.preOpenSituation()
  }

  /**
   * Amélioration du chargement de la liste
   * @param index
   * @param item
   * @returns
   */
  trackByDate(index: number, item: any) {
    return item.dateStart
  }

  /**
   * Demande de suppression del a fiche
   */
  async onDelete() {
    if (this.currentHR) {
      if (await this.humanResourceService.removeHrById(this.currentHR.id)) {
        this.router.navigate([&#x27;/ventilations&#x27;])
      }
    }
  }

  /**
   * Demande de modification d&#x27;une fiche
   * @param nodeName
   * @param value
   */
  async updateHuman(nodeName: string, value: any) {
    if (this.currentHR) {
      this.appService.appLoading.next(true)
      if (value &amp;&amp; typeof value.innerText !&#x3D;&#x3D; &#x27;undefined&#x27;) {
        value &#x3D; value.innerText
      }

      this.currentHR &#x3D; {
        ...this.currentHR,
        [nodeName]: value,
      }

      this.onLoad(
        await this.humanResourceService.updatePersonById(this.currentHR, {
          [nodeName]: value,
        }),
        false,
      )

      this.appService.appLoading.next(false)

      /* console.log({
        [nodeName]: value,
      }) */
    }
  }

  /**
   * Fermeture du paneau d&#x27;une situation
   * @param removeIndispo
   */
  async onCancel(removeIndispo: boolean &#x3D; false) {
    if (removeIndispo &amp;&amp; this.currentHR &amp;&amp; this.currentHR.indisponibilities.length) {
      await this.updateHuman(&#x27;indisponibilities&#x27;, [])
    }

    this.onEditIndex &#x3D; null

    const findElement &#x3D; document.getElementById(&#x27;content&#x27;)
    if (findElement) {
      findElement.scrollTo({
        behavior: &#x27;smooth&#x27;,
        top: 0,
      })
    }

    this.formatHRHistory()

    if (this.histories.length &#x3D;&#x3D;&#x3D; 0) {
      this.onEditIndex &#x3D; null
    }
  }

  /**
   * Demande de sauvegarde de la situation
   */
  onSave() {
    if (this.addDomVentilation) {
      this.addDomVentilation.onSave()
    }
  }

  /**
   * Demande de chargement de la fiche
   */
  onNewUpdate() {
    this.onEditIndex &#x3D; null
    this.onLoad(null, false)
  }

  /**
   * Demande d&#x27;ajout d&#x27;une indispo
   * @param indispo
   */
  onAddIndispiniblity(indispo: RHActivityInterface | null &#x3D; null) {
    this.updateIndisponiblity &#x3D; indispo
      ? copy(indispo)
      : {
          id: this.allIndisponibilities.length * -1 - 1,
          percent: 0,
          contentieux: {
            ...this.allIndisponibilityReferentiel[0],
          },
          dateStart: null,
        }
  }

  /**
   * Creation, modification et de suppression des indispo
   * @param action
   * @returns
   */
  async onEditIndisponibility(action: ActionsInterface) {
    const controlIndisponibilitiesError &#x3D; true // alway //this.onEditIndex &#x3D;&#x3D;&#x3D; null; // if panel ediction do not control error

    switch (action.id) {
      case &#x27;close&#x27;:
        {
          this.updateIndisponiblity &#x3D; null
        }
        break
      case &#x27;modify&#x27;:
        {
          if (this.updateIndisponiblity &amp;&amp; !this.updateIndisponiblity.dateStart) {
            alert(&quot;Vous devez saisir une date de début d&#x27;indisponibilité !&quot;)
            return false
          }

          if (this.updateIndisponiblity &amp;&amp; !this.updateIndisponiblity.percent) {
            alert(&quot;Vous devez saisir un temps d&#x27;indisponibilité !&quot;)
            return false
          }

          if (this.updateIndisponiblity &amp;&amp; this.updateIndisponiblity.percent &amp;&amp; this.updateIndisponiblity.percent &gt; 100) {
            alert(&quot;Vous ne pouvez pas saisir plus de 100% d&#x27;indisponibilité !&quot;)
            return false
          }

          if (this.updateIndisponiblity &amp;&amp; !this.updateIndisponiblity.dateStart) {
            alert(&quot;Vous devez saisir une date de départ d&#x27;indisponibilité !&quot;)
            return false
          }

          if (this.updateIndisponiblity &amp;&amp; !this.allIndisponibilityReferentiel.find((i) &#x3D;&gt; i.id &#x3D;&#x3D; this.updateIndisponiblity?.contentieux.id)) {
            alert(&quot;Vous devez saisir un type d&#x27;indisponibilité !&quot;)
            return false
          }

          // control date start
          if (this.currentHR &amp;&amp; this.currentHR.dateStart) {
            const hrDateStart &#x3D; today(this.currentHR.dateStart)

            if (this.updateIndisponiblity &amp;&amp; this.updateIndisponiblity.dateStart) {
              const indispDateStart &#x3D; today(this.updateIndisponiblity.dateStart)
              if (hrDateStart.getTime() &gt; indispDateStart.getTime()) {
                alert(&quot;Vous ne pouvez pas saisir une date de début d&#x27;indisponibilité antérieure à la date d&#x27;arrivée !&quot;)
                return false
              }
            }

            if (this.updateIndisponiblity &amp;&amp; this.updateIndisponiblity.dateStop) {
              const indispDateStop &#x3D; new Date(this.updateIndisponiblity.dateStop)
              if (hrDateStart.getTime() &gt; indispDateStop.getTime()) {
                alert(&quot;Vous ne pouvez pas saisir une date de fin d&#x27;indisponibilités antérieure à la date d&#x27;arrivée !&quot;)
                return false
              }
            }
          }

          // control date stop
          if (this.currentHR &amp;&amp; this.currentHR.dateEnd) {
            let hrDateStop &#x3D; new Date(this.currentHR.dateEnd)
            hrDateStop &#x3D; setTimeToMidDay(hrDateStop) || hrDateStop

            if (this.updateIndisponiblity &amp;&amp; this.updateIndisponiblity.dateStart) {
              const indispDateStart &#x3D; new Date(this.updateIndisponiblity.dateStart)
              if (hrDateStop.getTime() &lt; indispDateStart.getTime()) {
                alert(&quot;Vous ne pouvez pas saisir une date de début d&#x27;indisponibilité postérieure à la date de départ !&quot;)
                return false
              }
            }

            if (this.updateIndisponiblity &amp;&amp; this.updateIndisponiblity.dateStop) {
              const indispDateStop &#x3D; new Date(this.updateIndisponiblity.dateStop)
              if (hrDateStop.getTime() &lt; indispDateStop.getTime()) {
                alert(&quot;Vous ne pouvez pas saisir une date de fin d&#x27;indisponibilité postérieure à la date de départ !&quot;)
                return false
              }
            }
          }

          // control date start and date stop
          if (this.updateIndisponiblity &amp;&amp; this.updateIndisponiblity.dateStart &amp;&amp; this.updateIndisponiblity.dateStop) {
            const indispDateStart &#x3D; new Date(this.updateIndisponiblity.dateStart)
            const indispDateStop &#x3D; new Date(this.updateIndisponiblity.dateStop)
            if (indispDateStart.getTime() &gt; indispDateStop.getTime()) {
              alert(&#x27;Vous ne pouvez pas saisir une date de début postérieure à la date de fin !&#x27;)
              return false
            }
          }

          if (this.updateIndisponiblity) {
            // force id to int with selector
            this.updateIndisponiblity.contentieux.id &#x3D; +this.updateIndisponiblity.contentieux.id

            const index &#x3D; this.allIndisponibilities.findIndex((i) &#x3D;&gt; i.id &#x3D;&#x3D;&#x3D; this.updateIndisponiblity?.id)
            const contentieux &#x3D; this.allIndisponibilityReferentiel.find((c) &#x3D;&gt; c.id &#x3D;&#x3D;&#x3D; this.updateIndisponiblity?.contentieux.id)

            if (!contentieux) {
              alert(&quot;Il y a un problème avec l&#x27;indisponibilitiés choisie.&quot;)
              return false
            }

            const cacheOldIndispo &#x3D; [...this.allIndisponibilities]
            if (index !&#x3D;&#x3D; -1) {
              cacheOldIndispo[index] &#x3D; {
                ...this.allIndisponibilities[index],
                ...this.updateIndisponiblity,
                contentieux,
              }
            } else if (this.updateIndisponiblity) {
              cacheOldIndispo.push({
                ...this.updateIndisponiblity,
                contentieux,
              })
            }
            if (this.currentHR) {
              this.indisponibilityError &#x3D; this.humanResourceService.controlIndisponibilities(this.currentHR, cacheOldIndispo)
              if (controlIndisponibilitiesError &amp;&amp; this.indisponibilityError) {
                const errorToShow &#x3D; this.indisponibilityError
                this.indisponibilityError &#x3D; null // only control by alert
                alert(errorToShow)
                return false
              } else {
                this.updateIndisponiblity &#x3D; null
                this.allIndisponibilities &#x3D; [...cacheOldIndispo]
              }

              if (!this.indisponibilityError) {
                await this.updateHuman(&#x27;indisponibilities&#x27;, this.allIndisponibilities)
              }
            } else {
              this.updateIndisponiblity &#x3D; null
            }
          }
        }
        break
      case &#x27;delete&#x27;:
        {
          const index &#x3D; this.allIndisponibilities.findIndex((i) &#x3D;&gt; i.id &#x3D;&#x3D;&#x3D; ((this.updateIndisponiblity &amp;&amp; this.updateIndisponiblity.id) || &#x27;&#x27;))
          if (index !&#x3D;&#x3D; -1) {
            this.allIndisponibilities.splice(index, 1)
            if (this.currentHR) {
              this.indisponibilityError &#x3D; this.humanResourceService.controlIndisponibilities(this.currentHR, this.allIndisponibilities)

              if (!this.indisponibilityError) {
                await this.updateHuman(&#x27;indisponibilities&#x27;, this.allIndisponibilities)
              }
            }
          }
          this.updateIndisponiblity &#x3D; null
        }
        break
    }

    return true
  }

  /**
   * Demande de modification d&#x27;une situation
   * @param history
   */
  onSelectSituationToEdit(history: HistoryInterface | null &#x3D; null) {
    console.log(history, this.histories)

    const index &#x3D; history ? this.histories.findIndex((h) &#x3D;&gt; h.id &#x3D;&#x3D;&#x3D; history.id &amp;&amp; h.dateStart &#x3D;&#x3D;&#x3D; history.dateStart) : -1
    console.log(&#x27;index&#x27;, index)

    if (this.onEditIndex &#x3D;&#x3D;&#x3D; null) {
      if (index &#x3D;&#x3D;&#x3D; -1) {
        // add situation
        this.onEditIndex &#x3D; -1
      } else {
        // edit situation
        this.onEditIndex &#x3D; index
      }
    } else {
      alert(&#x27;Vous ne pouvez pas modifier plusieurs situations en même temps !&#x27;)
    }

    if (this.currentHR) {
      // force to control indisponibilities
      this.indisponibilityError &#x3D; this.humanResourceService.controlIndisponibilities(this.currentHR, this.currentHR.indisponibilities)
      // console.log({ indisponibilityError: this.indisponibilityError })
    }
  }

  /**
   * Demande de suppression d&#x27;une situation
   * @param id
   */
  async onRemoveSituation(id: number) {
    const callback &#x3D; async (forceAlert &#x3D; true) &#x3D;&gt; {
      this.appService.appLoading.next(true)
      const returnValue &#x3D; await this.humanResourceService.removeSituation(id, forceAlert)
      this.onEditIndex &#x3D; null

      // console.log(returnValue, this.histories.length, this.onEditIndex)
      if (returnValue) {
        // force to not show on boarding after delete last situation
        this.onLoad(returnValue)
      }
      this.appService.appLoading.next(false)
      if (this.histories.length &#x3D;&#x3D;&#x3D; 0) {
        this.currentETP &#x3D; null
        this.onEditIndex &#x3D; null
      }
    }

    if (this.currentHR &amp;&amp; this.currentHR.situations.length &#x3D;&#x3D;&#x3D; 1) {
      this.appService.alert.next({
        title: &#x27;Attention : &#x27;,
        text: &#x60;La suppression de cette situation entraînera la suppression de la fiche agent et cette opération sera irréversible.&lt;br/&gt;&lt;br/&gt;Si l&#x27;agent a quitté la juridiction, nous vous invitons à renseigner une date de départ.&lt;br/&gt;&lt;br/&gt;S’il fait toujours partie de vos effectifs, vous pouvez corriger ou conserver cette situation en l&#x27;état.&#x60;,
        secondaryText: &#x27;Conserver cette fiche&#x27;,
        callbackSecondary: () &#x3D;&gt; {},
        okText: &#x27;Supprimer cette fiche&#x27;,
        callback: () &#x3D;&gt; {
          callback(false)
        },
      })
    } else {
      callback(true)
    }
  }

  /**
   * Demande d&#x27;extraction de la page au format pdf
   */
  onExport() {
    this.hrCommentService.forceOpenAll.next(true)
    const parent &#x3D; document.getElementById(&#x27;first-panel&#x27;)
    const child &#x3D; document.getElementById(&#x27;comment-profil&#x27;)
    const parent2 &#x3D; document.getElementById(&#x27;wrapper-printed&#x27;)
    parent?.removeChild(child as Node)
    parent2?.appendChild(child as Node)

    const reduire1 &#x3D; document.getElementById(&#x27;logo-2&#x27;)
    const reduire2 &#x3D; document.getElementById(&#x27;logo-4&#x27;)

    const details &#x3D; document.getElementById(&#x27;second-row&#x27;)

    details?.classList.add(&#x27;size&#x27;)
    reduire1?.classList.add(&#x27;hide&#x27;)
    reduire2?.classList.add(&#x27;hide&#x27;)

    this.duringPrint &#x3D; true
    this.wrapper
      ?.exportAsPdf(
        &#x60;Fiche individuelle${this.currentHR ? &#x27; de &#x27; + this.currentHR.firstName + &#x27; &#x27; + this.currentHR.lastName : &#x27;&#x27;} en date du ${new Date()
          .toJSON()
          .slice(0, 10)}.pdf&#x60;,
      )
      .then(() &#x3D;&gt; {
        details?.classList.remove(&#x27;size&#x27;)
        reduire1?.classList.remove(&#x27;hide&#x27;)
        reduire2?.classList.remove(&#x27;hide&#x27;)
        this.hrCommentService.forceOpenAll.next(false)
        this.duringPrint &#x3D; false
        parent2?.removeChild(child as Node)
        parent?.appendChild(child as Node)
      })
  }

  /**
   * Enlever le focus du champ d&#x27;édition
   * @param event mouse event
   */
  blur(event: any) {
    event.target.blur()
  }

  /**
   * Force to open help panel
   * @param type
   */
  openHelpPanel(type: string | undefined) {
    switch (type) {
      case &#x27;indispo&#x27;:
        this.wrapper?.onForcePanelHelperToShow({
          title: &#x27;Ajouter des indisponibilités&#x27;,
          path: this.userService.isCa()
            ? &#x27;https://docs.a-just.beta.gouv.fr/guide-dutilisateur-a-just-ca/ventilateur/renseigner-les-indisponibilites&#x27;
            : &#x27;https://docs.a-just.beta.gouv.fr/documentation-deploiement/ventilateur/ajouter-des-indisponibilites&#x27;,
          subTitle: &quot;Qu&#x27;est-ce que c&#x27;est ?&quot;,
          printSubTitle: true,
        })
        break
      case &#x27;nouvelle-situation&#x27;:
        this.wrapper?.onForcePanelHelperToShow({
          title: &#x27;Enregistrer une nouvelle situation&#x27;,
          path: this.userService.isCa()
            ? &#x27;https://docs.a-just.beta.gouv.fr/guide-dutilisateur-a-just-ca/ventilateur/creer-ou-modifier-une-fiche/enregistrer-une-nouvelle-situation&#x27;
            : &#x27;https://docs.a-just.beta.gouv.fr/documentation-deploiement/ventilateur/creer-ou-modifier-une-fiche/enregistrer-une-nouvelle-situation&#x27;,
          subTitle: &quot;Qu&#x27;est-ce que c&#x27;est ?&quot;,
          printSubTitle: true,
        })
        break
      case &#x27;fix-fiche&#x27;:
        this.wrapper?.onForcePanelHelperToShow({
          title: &#x27;Corriger une fiche préexistante&#x27;,
          path: this.userService.isCa()
            ? &#x27;https://docs.a-just.beta.gouv.fr/guide-dutilisateur-a-just-ca/ventilateur/creer-ou-modifier-une-fiche/corriger-une-fiche-preexistante&#x27;
            : &#x27;https://docs.a-just.beta.gouv.fr/documentation-deploiement/ventilateur/creer-ou-modifier-une-fiche/corriger-une-fiche-preexistante&#x27;,
          subTitle: &quot;Qu&#x27;est-ce que c&#x27;est ?&quot;,
          printSubTitle: true,
        })
        break
      case &#x27;add-fiche&#x27;:
        this.wrapper?.onForcePanelHelperToShow({
          title: &#x27;Créer ou modifier une fiche&#x27;,
          path: &#x27;https://docs.a-just.beta.gouv.fr/documentation-deploiement/ventilateur/creer-ou-modifier-une-fiche&#x27;,
          subTitle: &quot;Qu&#x27;est-ce que c&#x27;est ?&quot;,
          printSubTitle: true,
        })
        break
      default:
        this.wrapper?.onForcePanelHelperToShow({
          title: &#x27;Fiche individuelle :&#x27;,
          path: &#x27;https://docs.a-just.beta.gouv.fr/documentation-deploiement/ventilateur/enregistrer-une-nouvelle-situation&#x27;,
          printSubTitle: true,
        })
    }
  }

  /**
   * Open panel
   */
  preOpenSituation() {
    const findIndex &#x3D; this.histories.findIndex((h) &#x3D;&gt; h.etp &#x3D;&#x3D;&#x3D; this.ETP_NEED_TO_BE_UPDATED)

    if (findIndex !&#x3D;&#x3D; -1) {
      this.onSelectSituationToEdit(this.histories[findIndex])
    }
  }

  /**
   * Fonction de mise à jours de l&#x27;etp courant pour la création d&#x27;un nouvel agent uniquement
   * @param etp
   */
  updateETP(etp: number | null) {
    if (!this.initialETP) {
      this.currentETP &#x3D; etp
    }
  }
  groupIndispoByCategory(): any {
    const grouped &#x3D; _.groupBy(this.allIndisponibilityReferentiel, (indispo) &#x3D;&gt; indispo.category)
    return grouped
  }

  setToMidDay(elem: Date) {
    return setTimeToMidDay(elem)
  }

  /**
   * Fonction de mise à jour des alertes
   * @param updatedList
   */
  onAlertsUpdated({ tag, remove &#x3D; false }: { tag: string; remove?: boolean }) {
    // Remove alert from the service
    if (remove) {
      this.humanResourceService.removeAlert(tag)
    } else {
      // Scroll to the &quot;Start Date&quot; selector
      // This ensures all users can see the element regardless of their screen size, and avoids manual scrolling.
      if (this.humanResourceService.alertList().length &gt; 0) {
        if (this.humanResourceService.alertList().includes(&#x27;activitiesStartDate&#x27;)) {
          if (this.addDomVentilation) this.addDomVentilation.scrollToBottomElement()
        } else if (this.humanResourceService.alertList().includes(&#x27;etp&#x27;)) {
          this.scrollTo(&#x27;etpForm&#x27;, document.getElementsByClassName(&#x27;wrapper-content&#x27;)[0], 250)
        }
      }
    }

    //this.humanResourceService.removeAlert(tag)
  }

  /**
   * Permet à l&#x27;utilisateur de passer d&#x27;un input à un autre avec la touche &quot;Entrée&quot;
   * @param event
   */
  focusNext({ event, calendarType }: { event: any; calendarType: string | null }) {
    // if (event.key &#x3D;&#x3D;&#x3D; &#x27;Tab&#x27;) {
    //   event.preventDefault();
    // }
    // console.log(&#x27;here&#x27;);
    if ((event &amp;&amp; event.key &#x3D;&#x3D;&#x3D; &#x27;Enter&#x27;) /*|| event.key &#x3D;&#x3D;&#x3D; &#x27;Tab&#x27;*/ || calendarType) {
      const inputsArray &#x3D; this.coverDetails.getInputs()
      if (!calendarType &amp;&amp; event.target.id !&#x3D;&#x3D; &#x27;matricule&#x27;) {
        event.preventDefault()
        const currentIndex &#x3D; inputsArray.findIndex((input: ElementRef) &#x3D;&gt; input.nativeElement &#x3D;&#x3D;&#x3D; event.target)
        if (currentIndex &gt; -1 &amp;&amp; currentIndex &lt; inputsArray.length - 1) {
          inputsArray[currentIndex + 1].nativeElement.focus()
        }
      } else {
        inputsArray.map((elem: ElementRef) &#x3D;&gt; elem.nativeElement.blur())

        if (this.coverDetails) {
          const calendars &#x3D; this.coverDetails.getCalendars()
          console.log(&#x27;calendars&#x27;, calendarType)
          if (event &amp;&amp; event.target.id &#x3D;&#x3D;&#x3D; &#x27;matricule&#x27;) {
            calendars[0].onClick()
          } else if (calendarType &amp;&amp; calendarType &#x3D;&#x3D;&#x3D; &#x27;dateStart&#x27;) {
            calendars[1].onClick()
          }
        }
      }
    }
  }
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'HistoryInterface.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
